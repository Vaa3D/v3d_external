<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>V3D: volimg_proc.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">V3D</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('volimg__proc_8h.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>volimg_proc.h</h1>  </div>
</div>
<div class="contents">
<a href="volimg__proc_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (c)2006-2010  Hanchuan Peng (Janelia Farm, Howard Hughes Medical Institute).  </span>
<a name="l00003"></a>00003 <span class="comment"> * All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment"> */</span>
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="comment">/************</span>
<a name="l00008"></a>00008 <span class="comment">                                            ********* LICENSE NOTICE ************</span>
<a name="l00009"></a>00009 <span class="comment"></span>
<a name="l00010"></a>00010 <span class="comment">This folder contains all source codes for the V3D project, which is subject to the following conditions if you want to use it. </span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">You will ***have to agree*** the following terms, *before* downloading/using/running/editing/changing any portion of codes in this package.</span>
<a name="l00013"></a>00013 <span class="comment"></span>
<a name="l00014"></a>00014 <span class="comment">1. This package is free for non-profit research, but needs a special license for any commercial purpose. Please contact Hanchuan Peng for details.</span>
<a name="l00015"></a>00015 <span class="comment"></span>
<a name="l00016"></a>00016 <span class="comment">2. You agree to appropriately cite this work in your related studies and publications.</span>
<a name="l00017"></a>00017 <span class="comment"></span>
<a name="l00018"></a>00018 <span class="comment">Peng, H., Ruan, Z., Long, F., Simpson, J.H., and Myers, E.W. (2010) “V3D enables real-time 3D visualization and quantitative analysis of large-scale biological image data sets,” Nature Biotechnology, Vol. 28, No. 4, pp. 348-353, DOI: 10.1038/nbt.1612. ( http://penglab.janelia.org/papersall/docpdf/2010_NBT_V3D.pdf )</span>
<a name="l00019"></a>00019 <span class="comment"></span>
<a name="l00020"></a>00020 <span class="comment">Peng, H, Ruan, Z., Atasoy, D., and Sternson, S. (2010) “Automatic reconstruction of 3D neuron structures using a graph-augmented deformable model,” Bioinformatics, Vol. 26, pp. i38-i46, 2010. ( http://penglab.janelia.org/papersall/docpdf/2010_Bioinfo_GD_ISMB2010.pdf )</span>
<a name="l00021"></a>00021 <span class="comment"></span>
<a name="l00022"></a>00022 <span class="comment">3. This software is provided by the copyright holders (Hanchuan Peng), Howard Hughes Medical Institute, Janelia Farm Research Campus, and contributors &quot;as is&quot; and any express or implied warranties, including, but not limited to, any implied warranties of merchantability, non-infringement, or fitness for a particular purpose are disclaimed. In no event shall the copyright owner, Howard Hughes Medical Institute, Janelia Farm Research Campus, or contributors be liable for any direct, indirect, incidental, special, exemplary, or consequential damages (including, but not limited to, procurement of substitute goods or services; loss of use, data, or profits; reasonable royalties; or business interruption) however caused and on any theory of liability, whether in contract, strict liability, or tort (including negligence or otherwise) arising in any way out of the use of this software, even if advised of the possibility of such damage.</span>
<a name="l00023"></a>00023 <span class="comment"></span>
<a name="l00024"></a>00024 <span class="comment">4. Neither the name of the Howard Hughes Medical Institute, Janelia Farm Research Campus, nor Hanchuan Peng, may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00025"></a>00025 <span class="comment"></span>
<a name="l00026"></a>00026 <span class="comment">*************/</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="comment">//volimg_proc.h</span>
<a name="l00032"></a>00032 <span class="comment">//</span>
<a name="l00033"></a>00033 <span class="comment">//Separate from laff project so that these functions will be common</span>
<a name="l00034"></a>00034 <span class="comment">//</span>
<a name="l00035"></a>00035 <span class="comment">//by Hanchuan Peng</span>
<a name="l00036"></a>00036 <span class="comment">//2008-04-14</span>
<a name="l00037"></a>00037 <span class="comment">//2008-05-03</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#ifndef __BASIC_VOLUME_IMG_PROCESSING__</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span><span class="preprocessor">#define __BASIC_VOLUME_IMG_PROCESSING__</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="volimg__proc__declare_8h.html">volimg_proc_declare.h</a>&quot;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="comment">//the actual definitions are below</span>
<a name="l00047"></a>00047 
<a name="l00048"></a><a class="code" href="volimg__proc__declare_8h.html#a36bd7cbf5031ff44e4e5895fbd63b4a9">00048</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; T <a class="code" href="volimg__proc_8h.html#a36bd7cbf5031ff44e4e5895fbd63b4a9">hardLimit</a>(T a, T lowerBound, T upperBound)
<a name="l00049"></a>00049 {
<a name="l00050"></a>00050     T b = (a&lt;lowerBound) ? lowerBound : a;
<a name="l00051"></a>00051     <span class="keywordflow">return</span> ((b&gt;upperBound) ? upperBound : b);
<a name="l00052"></a>00052 }
<a name="l00053"></a>00053 
<a name="l00054"></a><a class="code" href="volimg__proc__declare_8h.html#a5e267b98ab6be09fd26c1ac6fd393bd2">00054</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="volimg__proc_8h.html#a5e267b98ab6be09fd26c1ac6fd393bd2">swapValue</a>(T &amp; a, T &amp; b)
<a name="l00055"></a>00055 {
<a name="l00056"></a>00056     T tmp = a; a = b; b=tmp;
<a name="l00057"></a>00057     <span class="keywordflow">return</span>;
<a name="l00058"></a>00058 }
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 
<a name="l00061"></a><a class="code" href="volimg__proc__declare_8h.html#af6ecb2ab20c6154d293cc8506beabca2">00061</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#af6ecb2ab20c6154d293cc8506beabca2">vol3d_assign</a>(T *** res, T v, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2)
<a name="l00062"></a>00062 {
<a name="l00063"></a>00063     <span class="keywordflow">if</span> (!res || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00064"></a>00064         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00065"></a>00065 
<a name="l00066"></a>00066     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00067"></a>00067     <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00068"></a>00068     {
<a name="l00069"></a>00069         <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00070"></a>00070         {
<a name="l00071"></a>00071             <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00072"></a>00072             {
<a name="l00073"></a>00073                 res[k][j][i] = v;
<a name="l00074"></a>00074             }
<a name="l00075"></a>00075         }
<a name="l00076"></a>00076     }
<a name="l00077"></a>00077 
<a name="l00078"></a>00078     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00079"></a>00079 }
<a name="l00080"></a>00080 
<a name="l00081"></a><a class="code" href="volimg__proc__declare_8h.html#a2c3b6aab3bf9c70de9184820918cc7b6">00081</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#af6ecb2ab20c6154d293cc8506beabca2">vol3d_assign</a>(T *** res, T *** sa, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2)
<a name="l00082"></a>00082 {
<a name="l00083"></a>00083     <span class="keywordflow">if</span> (!res || !sa || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00084"></a>00084         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00085"></a>00085 
<a name="l00086"></a>00086     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00087"></a>00087     <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00088"></a>00088     {
<a name="l00089"></a>00089         <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00090"></a>00090         {
<a name="l00091"></a>00091             <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00092"></a>00092             {
<a name="l00093"></a>00093                 res[k][j][i] = sa[k][j][i];
<a name="l00094"></a>00094             }
<a name="l00095"></a>00095         }
<a name="l00096"></a>00096     }
<a name="l00097"></a>00097 
<a name="l00098"></a>00098     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00099"></a>00099 }
<a name="l00100"></a>00100 
<a name="l00101"></a><a class="code" href="volimg__proc__declare_8h.html#acebe564c3106584564bdd8c1d08f60fe">00101</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#acebe564c3106584564bdd8c1d08f60fe">vol3d_negative</a>(T *** res, T *** sa, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2)
<a name="l00102"></a>00102 {
<a name="l00103"></a>00103     <span class="keywordflow">if</span> (!res || !sa || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00104"></a>00104         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00105"></a>00105 
<a name="l00106"></a>00106     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00107"></a>00107     <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00108"></a>00108     {
<a name="l00109"></a>00109         <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00110"></a>00110         {
<a name="l00111"></a>00111             <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00112"></a>00112             {
<a name="l00113"></a>00113                 res[k][j][i] = (T)(-<span class="keywordtype">double</span>(sa[k][j][i]));
<a name="l00114"></a>00114             }
<a name="l00115"></a>00115         }
<a name="l00116"></a>00116     }
<a name="l00117"></a>00117 
<a name="l00118"></a>00118     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00119"></a>00119 }
<a name="l00120"></a>00120 
<a name="l00121"></a><a class="code" href="volimg__proc__declare_8h.html#a69d72c45603ad52697140cf9ed64c48a">00121</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#a69d72c45603ad52697140cf9ed64c48a">vol3d_inverse</a>(T *** res, T *** sa, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2)
<a name="l00122"></a>00122 {
<a name="l00123"></a>00123     <span class="keywordflow">if</span> (!res || !sa || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00124"></a>00124         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00125"></a>00125 
<a name="l00126"></a>00126     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00127"></a>00127     <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00128"></a>00128     {
<a name="l00129"></a>00129         <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00130"></a>00130         {
<a name="l00131"></a>00131             <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00132"></a>00132             {
<a name="l00133"></a>00133                 res[k][j][i] = (T)(1.0/<span class="keywordtype">double</span>(sa[k][j][i]));
<a name="l00134"></a>00134             }
<a name="l00135"></a>00135         }
<a name="l00136"></a>00136     }
<a name="l00137"></a>00137 
<a name="l00138"></a>00138     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00139"></a>00139 }
<a name="l00140"></a>00140 
<a name="l00141"></a><a class="code" href="volimg__proc__declare_8h.html#a90fee0cdc0e1c3a2ea85a743d58369f0">00141</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#a90fee0cdc0e1c3a2ea85a743d58369f0">vol3d_square</a>(T *** res, T *** sa, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2)
<a name="l00142"></a>00142 {
<a name="l00143"></a>00143     <span class="keywordflow">if</span> (!res || !sa || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00144"></a>00144         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00145"></a>00145 
<a name="l00146"></a>00146     <span class="keywordtype">double</span> tmp;
<a name="l00147"></a>00147     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00148"></a>00148     <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00149"></a>00149     {
<a name="l00150"></a>00150         <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00151"></a>00151         {
<a name="l00152"></a>00152             <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00153"></a>00153             {
<a name="l00154"></a>00154                 tmp = double(sa[k][j][i]);
<a name="l00155"></a>00155                 res[k][j][i] = (T)(tmp*tmp);
<a name="l00156"></a>00156             }
<a name="l00157"></a>00157         }
<a name="l00158"></a>00158     }
<a name="l00159"></a>00159 
<a name="l00160"></a>00160     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00161"></a>00161 }
<a name="l00162"></a>00162 
<a name="l00163"></a><a class="code" href="volimg__proc__declare_8h.html#ad0c4da2366057a22127e6269af7e4d8b">00163</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#ad0c4da2366057a22127e6269af7e4d8b">vol3d_root</a>(T *** res, T *** sa, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2)
<a name="l00164"></a>00164 {
<a name="l00165"></a>00165     <span class="keywordflow">if</span> (!res || !sa || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00166"></a>00166         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00167"></a>00167 
<a name="l00168"></a>00168     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00169"></a>00169     <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00170"></a>00170     {
<a name="l00171"></a>00171         <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00172"></a>00172         {
<a name="l00173"></a>00173             <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00174"></a>00174             {
<a name="l00175"></a>00175                 res[k][j][i] = (T)sqrt(<span class="keywordtype">double</span>(sa[k][j][i]));
<a name="l00176"></a>00176             }
<a name="l00177"></a>00177         }
<a name="l00178"></a>00178     }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00181"></a>00181 }
<a name="l00182"></a>00182 
<a name="l00183"></a><a class="code" href="volimg__proc__declare_8h.html#a3371de28de3044a6cfa9590943dcbf9d">00183</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#a3371de28de3044a6cfa9590943dcbf9d">vol3d_exp</a>(T *** res, T *** sa, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2)
<a name="l00184"></a>00184 {
<a name="l00185"></a>00185     <span class="keywordflow">if</span> (!res || !sa || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00186"></a>00186         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00189"></a>00189     <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00190"></a>00190     {
<a name="l00191"></a>00191         <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00192"></a>00192         {
<a name="l00193"></a>00193             <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00194"></a>00194             {
<a name="l00195"></a>00195                 res[k][j][i] = (T)exp(<span class="keywordtype">double</span>(sa[k][j][i]));
<a name="l00196"></a>00196             }
<a name="l00197"></a>00197         }
<a name="l00198"></a>00198     }
<a name="l00199"></a>00199 
<a name="l00200"></a>00200     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00201"></a>00201 }
<a name="l00202"></a>00202 
<a name="l00203"></a><a class="code" href="volimg__proc__declare_8h.html#ae6e0cc1bb8e7264cff46e866a6f1fdb6">00203</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#ae6e0cc1bb8e7264cff46e866a6f1fdb6">vol3d_log</a>(T *** res, T *** sa, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2)
<a name="l00204"></a>00204 {
<a name="l00205"></a>00205     <span class="keywordflow">if</span> (!res || !sa || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00206"></a>00206         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00207"></a>00207 
<a name="l00208"></a>00208     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00209"></a>00209     <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00210"></a>00210     {
<a name="l00211"></a>00211         <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00212"></a>00212         {
<a name="l00213"></a>00213             <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00214"></a>00214             {
<a name="l00215"></a>00215                 res[k][j][i] = (T)<a class="code" href="vcdiff_8cpp.html#ae518c10f472c43a247e3e9b0f0a75be2">log</a>(<span class="keywordtype">double</span>(sa[k][j][i]));
<a name="l00216"></a>00216             }
<a name="l00217"></a>00217         }
<a name="l00218"></a>00218     }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00221"></a>00221 }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223 
<a name="l00224"></a><a class="code" href="volimg__proc__declare_8h.html#a78906943d441ffd9f4043e36125d93da">00224</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#a78906943d441ffd9f4043e36125d93da">vol3d_min</a>(T &amp; res, T *** sa, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2)
<a name="l00225"></a>00225 {
<a name="l00226"></a>00226     <span class="keywordflow">if</span> (!res || !sa || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00227"></a>00227         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00228"></a>00228 
<a name="l00229"></a>00229     <span class="keywordtype">double</span> v;
<a name="l00230"></a>00230     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00231"></a>00231     v = (double)sa[0][0][0];
<a name="l00232"></a>00232     <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00233"></a>00233     {
<a name="l00234"></a>00234         <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00235"></a>00235         {
<a name="l00236"></a>00236             <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00237"></a>00237             {
<a name="l00238"></a>00238                 v = (double(sa[k][j][i]) &lt; v) ? <span class="keywordtype">double</span>(sa[k][j][i]) : v;
<a name="l00239"></a>00239             }
<a name="l00240"></a>00240         }
<a name="l00241"></a>00241     }
<a name="l00242"></a>00242     res = (T)v;
<a name="l00243"></a>00243 
<a name="l00244"></a>00244     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00245"></a>00245 }
<a name="l00246"></a>00246 
<a name="l00247"></a><a class="code" href="volimg__proc__declare_8h.html#a4512c413ed79090e010993848a5f0d9d">00247</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#a4512c413ed79090e010993848a5f0d9d">vol3d_max</a>(T &amp; res, T *** sa, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2)
<a name="l00248"></a>00248 {
<a name="l00249"></a>00249     <span class="keywordflow">if</span> (!res || !sa || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00250"></a>00250         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00251"></a>00251 
<a name="l00252"></a>00252     <span class="keywordtype">double</span> v;
<a name="l00253"></a>00253     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00254"></a>00254     v = (double)sa[0][0][0];
<a name="l00255"></a>00255     <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00256"></a>00256     {
<a name="l00257"></a>00257         <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00258"></a>00258         {
<a name="l00259"></a>00259             <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00260"></a>00260             {
<a name="l00261"></a>00261                 v = (double(sa[k][j][i]) &gt; v) ? <span class="keywordtype">double</span>(sa[k][j][i]) : v;
<a name="l00262"></a>00262             }
<a name="l00263"></a>00263         }
<a name="l00264"></a>00264     }
<a name="l00265"></a>00265     res = (T)v;
<a name="l00266"></a>00266 
<a name="l00267"></a>00267     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00268"></a>00268 }
<a name="l00269"></a>00269 
<a name="l00270"></a>00270 
<a name="l00271"></a><a class="code" href="volimg__proc__declare_8h.html#ae15ee5ad09582c9e3d0ac9649c61dcd4">00271</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#ae15ee5ad09582c9e3d0ac9649c61dcd4">vol3d_scale_01</a>(T *** res, T *** sa, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2)
<a name="l00272"></a>00272 {
<a name="l00273"></a>00273     <span class="keywordflow">if</span> (!res || !sa || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00274"></a>00274         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00275"></a>00275 
<a name="l00276"></a>00276     <span class="keywordtype">double</span> vm, vM;
<a name="l00277"></a>00277     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00278"></a>00278     vm = (double)sa[0][0][0];
<a name="l00279"></a>00279     vM = (double)sa[0][0][0];
<a name="l00280"></a>00280     <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00281"></a>00281     {
<a name="l00282"></a>00282         <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00283"></a>00283         {
<a name="l00284"></a>00284             <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00285"></a>00285             {
<a name="l00286"></a>00286                 vm = (double(sa[k][j][i]) &lt; vm) ? <span class="keywordtype">double</span>(sa[k][j][i]) : vm;
<a name="l00287"></a>00287                 vM = (double(sa[k][j][i]) &gt; vM) ? <span class="keywordtype">double</span>(sa[k][j][i]) : vM;
<a name="l00288"></a>00288             }
<a name="l00289"></a>00289         }
<a name="l00290"></a>00290     }
<a name="l00291"></a>00291 
<a name="l00292"></a>00292     <span class="keywordtype">double</span> L = vM-vm;
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     <span class="keywordflow">if</span> (L==0.0)
<a name="l00295"></a>00295     {
<a name="l00296"></a>00296         <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00297"></a>00297         {
<a name="l00298"></a>00298             <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00299"></a>00299             {
<a name="l00300"></a>00300                 <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00301"></a>00301                 {
<a name="l00302"></a>00302                     res[k][j][i] = (T)0;
<a name="l00303"></a>00303                 }
<a name="l00304"></a>00304             }
<a name="l00305"></a>00305         }
<a name="l00306"></a>00306     }
<a name="l00307"></a>00307     <span class="keywordflow">else</span>
<a name="l00308"></a>00308     {
<a name="l00309"></a>00309         <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00310"></a>00310         {
<a name="l00311"></a>00311             <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00312"></a>00312             {
<a name="l00313"></a>00313                 <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00314"></a>00314                 {
<a name="l00315"></a>00315                     res[k][j][i] = (T)((<span class="keywordtype">double</span>(res[k][j][i])-vm)/L);
<a name="l00316"></a>00316                 }
<a name="l00317"></a>00317             }
<a name="l00318"></a>00318         }
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320 
<a name="l00321"></a>00321     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00322"></a>00322 }
<a name="l00323"></a>00323 
<a name="l00324"></a><a class="code" href="volimg__proc__declare_8h.html#abe7db820093008c4579794e950783bac">00324</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#abe7db820093008c4579794e950783bac">vol3d_sum</a>(T &amp; res, T *** sa, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2)
<a name="l00325"></a>00325 {
<a name="l00326"></a>00326     <span class="keywordflow">if</span> (!res || !sa || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00327"></a>00327         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     <span class="keywordtype">double</span> v;
<a name="l00330"></a>00330     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00331"></a>00331     v = (double)0;
<a name="l00332"></a>00332     <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00333"></a>00333     {
<a name="l00334"></a>00334         <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00335"></a>00335         {
<a name="l00336"></a>00336             <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00337"></a>00337             {
<a name="l00338"></a>00338                 v += double(sa[k][j][i]);
<a name="l00339"></a>00339             }
<a name="l00340"></a>00340         }
<a name="l00341"></a>00341     }
<a name="l00342"></a>00342     res = (T)v;
<a name="l00343"></a>00343 
<a name="l00344"></a>00344     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00345"></a>00345 }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347 
<a name="l00348"></a><a class="code" href="volimg__proc__declare_8h.html#a5c3741326a8df9121233571aa2e063e8">00348</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#a5c3741326a8df9121233571aa2e063e8">vol3d_mean</a>(T &amp; res, T *** sa, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2)
<a name="l00349"></a>00349 {
<a name="l00350"></a>00350     <span class="keywordflow">if</span> (!res || !sa || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00351"></a>00351         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353     <span class="keywordtype">double</span> v;
<a name="l00354"></a>00354     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00355"></a>00355     v = (double)0;
<a name="l00356"></a>00356     <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00357"></a>00357     {
<a name="l00358"></a>00358         <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00359"></a>00359         {
<a name="l00360"></a>00360             <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00361"></a>00361             {
<a name="l00362"></a>00362                 v += double(sa[k][j][i]);
<a name="l00363"></a>00363             }
<a name="l00364"></a>00364         }
<a name="l00365"></a>00365     }
<a name="l00366"></a>00366     res = (T)(v/(<span class="keywordtype">double</span>(d0)*d1*d2));
<a name="l00367"></a>00367 
<a name="l00368"></a>00368     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00369"></a>00369 }
<a name="l00370"></a>00370 
<a name="l00371"></a><a class="code" href="volimg__proc__declare_8h.html#ab971a918224a63c481b6850151ab7003">00371</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#ab971a918224a63c481b6850151ab7003">vol3d_threshold</a>(T *** res, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2, T thres, <span class="keywordtype">bool</span> b_set_to_binary)
<a name="l00372"></a>00372 {
<a name="l00373"></a>00373     <span class="keywordflow">if</span> (!res || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00374"></a>00374         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00375"></a>00375 
<a name="l00376"></a>00376     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00377"></a>00377     <span class="keywordflow">if</span> (b_set_to_binary==<span class="keyword">false</span>)
<a name="l00378"></a>00378     {
<a name="l00379"></a>00379         <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00380"></a>00380         {
<a name="l00381"></a>00381             <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00382"></a>00382             {
<a name="l00383"></a>00383                 <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00384"></a>00384                 {
<a name="l00385"></a>00385                     <span class="keywordflow">if</span> (res[k][j][i]&lt;thres)
<a name="l00386"></a>00386                       res[k][j][i] = (T)0;
<a name="l00387"></a>00387                 }
<a name="l00388"></a>00388             }
<a name="l00389"></a>00389         }
<a name="l00390"></a>00390     }
<a name="l00391"></a>00391     <span class="keywordflow">else</span>
<a name="l00392"></a>00392     {
<a name="l00393"></a>00393         <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00394"></a>00394         {
<a name="l00395"></a>00395             <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00396"></a>00396             {
<a name="l00397"></a>00397                 <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00398"></a>00398                 {
<a name="l00399"></a>00399                     <span class="keywordflow">if</span> (res[k][j][i]&lt;thres)
<a name="l00400"></a>00400                       res[k][j][i] = (T)0;
<a name="l00401"></a>00401                     <span class="keywordflow">else</span>
<a name="l00402"></a>00402                       res[k][j][i] = (T)1;
<a name="l00403"></a>00403                 }
<a name="l00404"></a>00404             }
<a name="l00405"></a>00405         }
<a name="l00406"></a>00406     }
<a name="l00407"></a>00407 
<a name="l00408"></a>00408     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00409"></a>00409 }
<a name="l00410"></a>00410 
<a name="l00411"></a><a class="code" href="volimg__proc__declare_8h.html#a3b126e0aa1c1e1078a4a9b0ddc575824">00411</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#a3b126e0aa1c1e1078a4a9b0ddc575824">vol3d_nnz</a>(<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> &amp;nnz, T *** sa, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0b, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0e, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1b, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1e, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2b, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2e)
<a name="l00412"></a>00412 {
<a name="l00413"></a>00413     <span class="keywordflow">if</span> (!sa || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00414"></a>00414         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00415"></a>00415 
<a name="l00416"></a>00416     <span class="keywordflow">if</span> (d0b&lt;0 || d0b&gt;=d0 || d0e&lt;0 || d0e&gt;=d0 || d0b&gt;d0e ||
<a name="l00417"></a>00417         d1b&lt;0 || d1b&gt;=d1 || d1e&lt;0 || d1e&gt;=d1 || d1b&gt;d1e ||
<a name="l00418"></a>00418         d2b&lt;0 || d2b&gt;=d2 || d2e&lt;0 || d2e&gt;=d2 || d2b&gt;d2e)
<a name="l00419"></a>00419         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00420"></a>00420 
<a name="l00421"></a>00421     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00422"></a>00422     nnz=0;
<a name="l00423"></a>00423     <span class="keywordflow">for</span> (k=d2b;k&lt;=d2e;k++)
<a name="l00424"></a>00424     {
<a name="l00425"></a>00425         <span class="keywordflow">for</span> (j=d1b;j&lt;=d1e;j++)
<a name="l00426"></a>00426         {
<a name="l00427"></a>00427             <span class="keywordflow">for</span> (i=d0b;i&lt;=d0e;i++)
<a name="l00428"></a>00428             {
<a name="l00429"></a>00429                 <span class="keywordflow">if</span> (sa[k][j][i]) nnz++;
<a name="l00430"></a>00430             }
<a name="l00431"></a>00431         }
<a name="l00432"></a>00432     }
<a name="l00433"></a>00433 
<a name="l00434"></a>00434     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00435"></a>00435 }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437 
<a name="l00438"></a><a class="code" href="volimg__proc__declare_8h.html#a4dcc04d1b9c0748816b49a691fbebafa">00438</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#a4dcc04d1b9c0748816b49a691fbebafa">vol3d_plus</a>(T *** res, T *** sa, T *** sb, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2)
<a name="l00439"></a>00439 {
<a name="l00440"></a>00440     <span class="keywordflow">if</span> (!res || !sa || !sb || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00441"></a>00441         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00442"></a>00442 
<a name="l00443"></a>00443     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00444"></a>00444     <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00445"></a>00445     {
<a name="l00446"></a>00446         <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00447"></a>00447         {
<a name="l00448"></a>00448             <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00449"></a>00449             {
<a name="l00450"></a>00450                 res[k][j][i] = (T)(<span class="keywordtype">double</span>(sa[k][j][i]) + double(sb[k][j][i]));
<a name="l00451"></a>00451             }
<a name="l00452"></a>00452         }
<a name="l00453"></a>00453     }
<a name="l00454"></a>00454 
<a name="l00455"></a>00455     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00456"></a>00456 }
<a name="l00457"></a>00457 
<a name="l00458"></a><a class="code" href="volimg__proc__declare_8h.html#a949fce01e8ecf040d85d6e29cfa3fb86">00458</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#a949fce01e8ecf040d85d6e29cfa3fb86">vol3d_plus_constant</a>(T *** res, T *** sa, <span class="keywordtype">double</span> c, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2)
<a name="l00459"></a>00459 {
<a name="l00460"></a>00460     <span class="keywordflow">if</span> (!res || !sa || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00461"></a>00461         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00462"></a>00462 
<a name="l00463"></a>00463     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00464"></a>00464     <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00465"></a>00465     {
<a name="l00466"></a>00466         <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00467"></a>00467         {
<a name="l00468"></a>00468             <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00469"></a>00469             {
<a name="l00470"></a>00470                 res[k][j][i] = (T)(<span class="keywordtype">double</span>(sa[k][j][i]) + c);
<a name="l00471"></a>00471             }
<a name="l00472"></a>00472         }
<a name="l00473"></a>00473     }
<a name="l00474"></a>00474 
<a name="l00475"></a>00475     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00476"></a>00476 }
<a name="l00477"></a>00477 
<a name="l00478"></a><a class="code" href="volimg__proc__declare_8h.html#a306330207c710b0818fcda520874b327">00478</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#a306330207c710b0818fcda520874b327">vol3d_minus</a>(T *** res, T *** sa, T *** sb, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2)
<a name="l00479"></a>00479 {
<a name="l00480"></a>00480     <span class="keywordflow">if</span> (!res || !sa || !sb || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00481"></a>00481         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00482"></a>00482 
<a name="l00483"></a>00483     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00484"></a>00484     <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00485"></a>00485     {
<a name="l00486"></a>00486         <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00487"></a>00487         {
<a name="l00488"></a>00488             <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00489"></a>00489             {
<a name="l00490"></a>00490                 res[k][j][i] = (T)(<span class="keywordtype">double</span>(sa[k][j][i]) - double(sb[k][j][i]));
<a name="l00491"></a>00491             }
<a name="l00492"></a>00492         }
<a name="l00493"></a>00493     }
<a name="l00494"></a>00494 
<a name="l00495"></a>00495     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00496"></a>00496 }
<a name="l00497"></a>00497 
<a name="l00498"></a><a class="code" href="volimg__proc__declare_8h.html#a849cffddf7bede0e9294251d3eff28c2">00498</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#a849cffddf7bede0e9294251d3eff28c2">vol3d_time</a>(T *** res, T *** sa, T *** sb, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2)
<a name="l00499"></a>00499 {
<a name="l00500"></a>00500     <span class="keywordflow">if</span> (!res || !sa || !sb || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00501"></a>00501         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00502"></a>00502 
<a name="l00503"></a>00503     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00504"></a>00504     <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00505"></a>00505     {
<a name="l00506"></a>00506         <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00507"></a>00507         {
<a name="l00508"></a>00508             <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00509"></a>00509             {
<a name="l00510"></a>00510                 res[k][j][i] = (T)(<span class="keywordtype">double</span>(sa[k][j][i]) * double(sb[k][j][i]));
<a name="l00511"></a>00511             }
<a name="l00512"></a>00512         }
<a name="l00513"></a>00513     }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00516"></a>00516 }
<a name="l00517"></a>00517 
<a name="l00518"></a><a class="code" href="volimg__proc__declare_8h.html#af1d6adf243cd501c5b8f76fa3135fc3d">00518</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#af1d6adf243cd501c5b8f76fa3135fc3d">vol3d_time_constant</a>(T *** res, T *** sa, <span class="keywordtype">double</span> c, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2)
<a name="l00519"></a>00519 {
<a name="l00520"></a>00520     <span class="keywordflow">if</span> (!res || !sa || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00521"></a>00521         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00522"></a>00522 
<a name="l00523"></a>00523     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00524"></a>00524     <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00525"></a>00525     {
<a name="l00526"></a>00526         <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00527"></a>00527         {
<a name="l00528"></a>00528             <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00529"></a>00529             {
<a name="l00530"></a>00530                 res[k][j][i] = (T)(<span class="keywordtype">double</span>(sa[k][j][i]) * c);
<a name="l00531"></a>00531             }
<a name="l00532"></a>00532         }
<a name="l00533"></a>00533     }
<a name="l00534"></a>00534 
<a name="l00535"></a>00535     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00536"></a>00536 }
<a name="l00537"></a>00537 
<a name="l00538"></a><a class="code" href="volimg__proc__declare_8h.html#afaddb8bb13345a4e4f9b3d7ffa5d4686">00538</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#afaddb8bb13345a4e4f9b3d7ffa5d4686">vol3d_divide</a>(T *** res, T *** sa, T *** sb, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2)
<a name="l00539"></a>00539 {
<a name="l00540"></a>00540     <span class="keywordflow">if</span> (!res || !sa || !sb || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00541"></a>00541         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00542"></a>00542 
<a name="l00543"></a>00543     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00544"></a>00544     <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00545"></a>00545     {
<a name="l00546"></a>00546         <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00547"></a>00547         {
<a name="l00548"></a>00548             <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00549"></a>00549             {
<a name="l00550"></a>00550                 res[k][j][i] = (T)(<span class="keywordtype">double</span>(sa[k][j][i])/double(sb[k][j][i]));
<a name="l00551"></a>00551             }
<a name="l00552"></a>00552         }
<a name="l00553"></a>00553     }
<a name="l00554"></a>00554 
<a name="l00555"></a>00555     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00556"></a>00556 }
<a name="l00557"></a>00557 
<a name="l00558"></a>00558 
<a name="l00559"></a><a class="code" href="volimg__proc__declare_8h.html#af89434ea3acd415f27df35c6f29f4350">00559</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#af89434ea3acd415f27df35c6f29f4350">vol3d_square_root_diff</a>(<span class="keywordtype">double</span> &amp; res, T *** sa, T *** sb, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> d2)
<a name="l00560"></a>00560 {
<a name="l00561"></a>00561     <span class="keywordflow">if</span> (!sa || !sb || d0&lt;=0 || d1&lt;=0 || d2&lt;=0)
<a name="l00562"></a>00562         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00563"></a>00563 
<a name="l00564"></a>00564     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k;
<a name="l00565"></a>00565     <span class="keywordtype">double</span> tmp;
<a name="l00566"></a>00566     res = 0.0;
<a name="l00567"></a>00567     <span class="keywordflow">for</span> (k=0;k&lt;d2;k++)
<a name="l00568"></a>00568     {
<a name="l00569"></a>00569         <span class="keywordflow">for</span> (j=0;j&lt;d1;j++)
<a name="l00570"></a>00570         {
<a name="l00571"></a>00571             <span class="keywordflow">for</span> (i=0;i&lt;d0;i++)
<a name="l00572"></a>00572             {
<a name="l00573"></a>00573                 tmp = (double(sa[k][j][i]) - double(sb[k][j][i]));
<a name="l00574"></a>00574                 res += tmp*tmp;
<a name="l00575"></a>00575             }
<a name="l00576"></a>00576         }
<a name="l00577"></a>00577     }
<a name="l00578"></a>00578     res = sqrt(res);
<a name="l00579"></a>00579 
<a name="l00580"></a>00580     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00581"></a>00581 }
<a name="l00582"></a>00582 
<a name="l00583"></a><a class="code" href="volimg__proc__declare_8h.html#a3e5581743fd93d71e4cbd04db81945a6">00583</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T1, <span class="keyword">class</span> T2&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#a3e5581743fd93d71e4cbd04db81945a6">mean_and_std</a>(T1 *data, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> n, T2 &amp; ave, T2 &amp; sdev)
<a name="l00584"></a>00584 {
<a name="l00585"></a>00585     <span class="keywordflow">if</span> (!data || n&lt;=0)
<a name="l00586"></a>00586       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00587"></a>00587 
<a name="l00588"></a>00588     <span class="keywordtype">int</span> j;
<a name="l00589"></a>00589     <span class="keywordtype">double</span> ep=0.0,s,p;
<a name="l00590"></a>00590 
<a name="l00591"></a>00591     <span class="keywordflow">if</span> (n &lt;= 1)
<a name="l00592"></a>00592     {
<a name="l00593"></a>00593       <span class="comment">//printf(&quot;len must be at least 2 in mean_and_std\n&quot;);</span>
<a name="l00594"></a>00594       ave = data[0];
<a name="l00595"></a>00595       sdev = (T2)0;
<a name="l00596"></a>00596       <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">//do nothing</span>
<a name="l00597"></a>00597     }
<a name="l00598"></a>00598 
<a name="l00599"></a>00599     s=0.0;
<a name="l00600"></a>00600     <span class="keywordflow">for</span> (j=0;j&lt;n;j++) s += data[j];
<a name="l00601"></a>00601     <span class="keywordtype">double</span> ave_double=(T2)(s/n); <span class="comment">//use ave_double for the best accuracy</span>
<a name="l00602"></a>00602 
<a name="l00603"></a>00603     <span class="keywordtype">double</span> var=0.0;
<a name="l00604"></a>00604     <span class="keywordflow">for</span> (j=0;j&lt;n;j++) {
<a name="l00605"></a>00605         s=data[j]-(ave_double);
<a name="l00606"></a>00606         var += (p=s*s);
<a name="l00607"></a>00607     }
<a name="l00608"></a>00608     var=(var-ep*ep/n)/(n-1);
<a name="l00609"></a>00609     sdev=(T2)(sqrt(var));
<a name="l00610"></a>00610     ave=(T2)ave_double; <span class="comment">//use ave_double for the best accuracy</span>
<a name="l00611"></a>00611 
<a name="l00612"></a>00612     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00613"></a>00613 }
<a name="l00614"></a>00614 
<a name="l00615"></a><a class="code" href="volimg__proc__declare_8h.html#ab316b308e391d9811440dc67cb6b06ae">00615</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#a3e5581743fd93d71e4cbd04db81945a6">mean_and_std</a>(T *data, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> n, T &amp; ave, T &amp; sdev, T maskval)
<a name="l00616"></a>00616 {
<a name="l00617"></a>00617     <span class="keywordflow">if</span> (!data || n&lt;=0)
<a name="l00618"></a>00618       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00619"></a>00619 
<a name="l00620"></a>00620     <span class="keywordtype">int</span> j;
<a name="l00621"></a>00621     <span class="keywordtype">double</span> ep=0.0,s,p;
<a name="l00622"></a>00622 
<a name="l00623"></a>00623     <span class="keywordflow">if</span> (n &lt;= 1)
<a name="l00624"></a>00624     {
<a name="l00625"></a>00625       <span class="comment">//printf(&quot;len must be at least 2 in mean_and_std\n&quot;);</span>
<a name="l00626"></a>00626       ave = data[0];
<a name="l00627"></a>00627       sdev = (T)0;
<a name="l00628"></a>00628       <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">//do nothing</span>
<a name="l00629"></a>00629     }
<a name="l00630"></a>00630 
<a name="l00631"></a>00631     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> n_use;
<a name="l00632"></a>00632 
<a name="l00633"></a>00633     s=0.0;
<a name="l00634"></a>00634     <span class="keywordflow">for</span> (j=0, n_use=0;j&lt;n;j++) {<span class="keywordflow">if</span> (data[j]!=maskval) {s += data[j]; n_use++;}}
<a name="l00635"></a>00635     <span class="keywordflow">if</span> (n_use&lt;=0)
<a name="l00636"></a>00636     {
<a name="l00637"></a>00637       ave = data[0];
<a name="l00638"></a>00638       sdev = (T)0;
<a name="l00639"></a>00639       <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">//do nothing if everything is equal maskval</span>
<a name="l00640"></a>00640     }
<a name="l00641"></a>00641     <span class="keywordflow">if</span> (n_use==1)
<a name="l00642"></a>00642     {
<a name="l00643"></a>00643       ave=s;
<a name="l00644"></a>00644       sdev = T(0);
<a name="l00645"></a>00645       <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">//do nothing if there is only one 1 value</span>
<a name="l00646"></a>00646     }
<a name="l00647"></a>00647 
<a name="l00648"></a>00648     <span class="keywordtype">double</span> ave_double=(T)(s/n_use); <span class="comment">//use ave_double for the best accuracy</span>
<a name="l00649"></a>00649 
<a name="l00650"></a>00650     <span class="keywordtype">double</span> var=0.0;
<a name="l00651"></a>00651     <span class="keywordflow">for</span> (j=0;j&lt;n;j++)
<a name="l00652"></a>00652     {
<a name="l00653"></a>00653         <span class="keywordflow">if</span> (data[j]!=maskval)
<a name="l00654"></a>00654         {
<a name="l00655"></a>00655             s=data[j]-(ave_double);
<a name="l00656"></a>00656             var += (p=s*s);
<a name="l00657"></a>00657         }
<a name="l00658"></a>00658     }
<a name="l00659"></a>00659     var=(var-ep*ep/n_use)/(n_use-1);
<a name="l00660"></a>00660     sdev=(T)(sqrt(var));
<a name="l00661"></a>00661     ave=(T)ave_double; <span class="comment">//use ave_double for the best accuracy</span>
<a name="l00662"></a>00662 
<a name="l00663"></a>00663     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00664"></a>00664 }
<a name="l00665"></a>00665 
<a name="l00666"></a><a class="code" href="volimg__proc__declare_8h.html#a284e82c3beef7072fb590aae650c4c59">00666</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#a3e5581743fd93d71e4cbd04db81945a6">mean_and_std</a>(T *data, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> n, T &amp; ave, T &amp; sdev, T maskval_lowerbound, T maskval_upperbound)
<a name="l00667"></a>00667 {
<a name="l00668"></a>00668     <span class="keywordflow">if</span> (!data || n&lt;=0)
<a name="l00669"></a>00669       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00670"></a>00670 
<a name="l00671"></a>00671     <span class="keywordtype">int</span> j;
<a name="l00672"></a>00672     <span class="keywordtype">double</span> ep=0.0,s,p;
<a name="l00673"></a>00673 
<a name="l00674"></a>00674     <span class="keywordflow">if</span> (n &lt;= 1)
<a name="l00675"></a>00675     {
<a name="l00676"></a>00676       <span class="comment">//printf(&quot;len must be at least 2 in mean_and_std\n&quot;);</span>
<a name="l00677"></a>00677       ave = data[0];
<a name="l00678"></a>00678       sdev = (T)0;
<a name="l00679"></a>00679       <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">//do nothing</span>
<a name="l00680"></a>00680     }
<a name="l00681"></a>00681 
<a name="l00682"></a>00682     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> n_use;
<a name="l00683"></a>00683 
<a name="l00684"></a>00684     <span class="keywordflow">if</span> (maskval_lowerbound&gt;maskval_upperbound) {T tmp=maskval_lowerbound; maskval_lowerbound=maskval_upperbound; maskval_upperbound=tmp;} <span class="comment">//070528: assure the range is valid</span>
<a name="l00685"></a>00685 
<a name="l00686"></a>00686     s=0.0;
<a name="l00687"></a>00687     <span class="keywordflow">for</span> (j=0, n_use=0;j&lt;n;j++) {<span class="keywordflow">if</span> (data[j]&lt;maskval_lowerbound || data[j]&gt;maskval_upperbound) {s += data[j]; n_use++;}}
<a name="l00688"></a>00688     <span class="keywordflow">if</span> (n_use&lt;=0)
<a name="l00689"></a>00689     {
<a name="l00690"></a>00690       ave = data[0];
<a name="l00691"></a>00691       sdev = (T)0;
<a name="l00692"></a>00692       <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">//do nothing if everything is equal maskval</span>
<a name="l00693"></a>00693     }
<a name="l00694"></a>00694     <span class="keywordflow">if</span> (n_use==1)
<a name="l00695"></a>00695     {
<a name="l00696"></a>00696       ave=s;
<a name="l00697"></a>00697       sdev = T(0);
<a name="l00698"></a>00698       <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">//do nothing if there is only one 1 value</span>
<a name="l00699"></a>00699     }
<a name="l00700"></a>00700 
<a name="l00701"></a>00701     <span class="keywordtype">double</span> ave_double=(T)(s/n_use); <span class="comment">//use ave_double for the best accuracy</span>
<a name="l00702"></a>00702 
<a name="l00703"></a>00703     <span class="keywordtype">double</span> var=0.0;
<a name="l00704"></a>00704     <span class="keywordflow">for</span> (j=0;j&lt;n;j++)
<a name="l00705"></a>00705     {
<a name="l00706"></a>00706         <span class="keywordflow">if</span> (data[j]&lt;maskval_lowerbound || data[j]&gt;maskval_upperbound)
<a name="l00707"></a>00707         {
<a name="l00708"></a>00708             s=data[j]-(ave_double);
<a name="l00709"></a>00709             var += (p=s*s);
<a name="l00710"></a>00710         }
<a name="l00711"></a>00711     }
<a name="l00712"></a>00712     var=(var-ep*ep/n_use)/(n_use-1);
<a name="l00713"></a>00713     sdev=(T)(sqrt(var));
<a name="l00714"></a>00714     ave=(T)ave_double; <span class="comment">//use ave_double for the best accuracy</span>
<a name="l00715"></a>00715 
<a name="l00716"></a>00716     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00717"></a>00717 }
<a name="l00718"></a>00718 
<a name="l00719"></a><a class="code" href="volimg__proc__declare_8h.html#ac48729a826f31cbafa82c1c8f4e65ccc">00719</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="volimg__proc_8h.html#ac48729a826f31cbafa82c1c8f4e65ccc">moment</a>(T *data, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> n, <span class="keywordtype">double</span> &amp; ave, <span class="keywordtype">double</span> &amp; adev, <span class="keywordtype">double</span> &amp; sdev, <span class="keywordtype">double</span> &amp; var, <span class="keywordtype">double</span> &amp; skew, <span class="keywordtype">double</span> &amp; curt)
<a name="l00720"></a>00720 {
<a name="l00721"></a>00721     <span class="keywordtype">int</span> j;
<a name="l00722"></a>00722     <span class="keywordtype">double</span> ep=0.0,s,p;
<a name="l00723"></a>00723 
<a name="l00724"></a>00724     <span class="keywordflow">if</span> (n &lt;= 1)
<a name="l00725"></a>00725     {
<a name="l00726"></a>00726         printf(<span class="stringliteral">&quot;len must be at least 2 in moment\n&quot;</span>);
<a name="l00727"></a>00727         <span class="keywordflow">return</span>; <span class="comment">//do nothing</span>
<a name="l00728"></a>00728     }
<a name="l00729"></a>00729 
<a name="l00730"></a>00730     s=0.0;
<a name="l00731"></a>00731     <span class="keywordflow">for</span> (j=0;j&lt;n;j++) s += data[j];
<a name="l00732"></a>00732     ave=s/n;
<a name="l00733"></a>00733     adev=var=skew=curt=0.0;
<a name="l00734"></a>00734     <span class="keywordflow">for</span> (j=0;j&lt;n;j++) {
<a name="l00735"></a>00735         adev += <a class="code" href="vcdiff_8cpp.html#a4944b5e42d05782ac1d8a9d0f7502b87">fabs</a>(s=data[j]-(ave));
<a name="l00736"></a>00736         var += (p=s*s);
<a name="l00737"></a>00737         skew += (p *= s);
<a name="l00738"></a>00738         curt += (p *= s);
<a name="l00739"></a>00739     }
<a name="l00740"></a>00740     adev /= n;
<a name="l00741"></a>00741     var=(var-ep*ep/n)/(n-1);
<a name="l00742"></a>00742     sdev=sqrt(var);
<a name="l00743"></a>00743     <span class="keywordflow">if</span> (var) {
<a name="l00744"></a>00744         skew /= (n*var*sdev);
<a name="l00745"></a>00745         curt=curt/(n*var*var)-3.0;
<a name="l00746"></a>00746     }
<a name="l00747"></a>00747     <span class="keywordflow">else</span> <span class="comment">//No skew/kurtosis defined when variance = 0</span>
<a name="l00748"></a>00748     {
<a name="l00749"></a>00749         skew = 0;
<a name="l00750"></a>00750         curt = 0;
<a name="l00751"></a>00751     }
<a name="l00752"></a>00752 }
<a name="l00753"></a>00753 
<a name="l00754"></a><a class="code" href="volimg__proc__declare_8h.html#a07be75cddb00b60f61db3550d90340d2">00754</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; T <a class="code" href="volimg__proc_8h.html#a07be75cddb00b60f61db3550d90340d2">minInVector</a>(T * p, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> len, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> &amp;pos)
<a name="l00755"></a>00755 {
<a name="l00756"></a>00756     T a = p[0];
<a name="l00757"></a>00757     pos = 0;
<a name="l00758"></a>00758     <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i=1;i&lt;len;i++)
<a name="l00759"></a>00759     {
<a name="l00760"></a>00760         <span class="keywordflow">if</span> (p[i]&lt;a)
<a name="l00761"></a>00761         {
<a name="l00762"></a>00762             a = p[i];
<a name="l00763"></a>00763             pos = i;
<a name="l00764"></a>00764         }
<a name="l00765"></a>00765     }
<a name="l00766"></a>00766     <span class="keywordflow">return</span> a;
<a name="l00767"></a>00767 }
<a name="l00768"></a>00768 
<a name="l00769"></a><a class="code" href="volimg__proc__declare_8h.html#acd33b88a40ac7c42837e5020b3b05816">00769</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; T <a class="code" href="volimg__proc_8h.html#acd33b88a40ac7c42837e5020b3b05816">maxInVector</a>(T * p, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> len, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> &amp;pos)
<a name="l00770"></a>00770 {
<a name="l00771"></a>00771     T a = p[0];
<a name="l00772"></a>00772     pos = 0;
<a name="l00773"></a>00773     <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i=1;i&lt;len;i++)
<a name="l00774"></a>00774     {
<a name="l00775"></a>00775         <span class="keywordflow">if</span> (p[i]&gt;a)
<a name="l00776"></a>00776         {
<a name="l00777"></a>00777             a = p[i];
<a name="l00778"></a>00778             pos = i;
<a name="l00779"></a>00779         }
<a name="l00780"></a>00780     }
<a name="l00781"></a>00781     <span class="keywordflow">return</span> a;
<a name="l00782"></a>00782 }
<a name="l00783"></a>00783 
<a name="l00784"></a><a class="code" href="volimg__proc__declare_8h.html#af01d02395cff2663df502fce6ecbf69e">00784</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#af01d02395cff2663df502fce6ecbf69e">minMaxInVector</a>(T * p, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> len, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> &amp;pos_min, T &amp;minv, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> &amp;pos_max, T &amp;maxv)
<a name="l00785"></a>00785 {
<a name="l00786"></a>00786     <span class="keywordflow">if</span> (!p || len &lt;= 0)
<a name="l00787"></a>00787         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00788"></a>00788     
<a name="l00789"></a>00789     minv = maxv = p[0];
<a name="l00790"></a>00790     pos_min = pos_max = 0;
<a name="l00791"></a>00791     <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i=1;i&lt;len;i++)
<a name="l00792"></a>00792     {
<a name="l00793"></a>00793         <span class="keywordflow">if</span> (p[i]&gt;maxv)
<a name="l00794"></a>00794         {
<a name="l00795"></a>00795             maxv = p[i];
<a name="l00796"></a>00796             pos_max = i;
<a name="l00797"></a>00797         }
<a name="l00798"></a>00798         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p[i]&lt;minv)
<a name="l00799"></a>00799         {
<a name="l00800"></a>00800             minv = p[i];
<a name="l00801"></a>00801             pos_min = i;
<a name="l00802"></a>00802         }
<a name="l00803"></a>00803     }
<a name="l00804"></a>00804     
<a name="l00805"></a>00805     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00806"></a>00806 }
<a name="l00807"></a>00807 
<a name="l00808"></a>00808 
<a name="l00809"></a>00809 
<a name="l00810"></a>00810 <span class="comment">//fit to a data cube with a different 3D size</span>
<a name="l00811"></a><a class="code" href="volimg__proc__declare_8h.html#ab55b77950270df472006227e6594ae77">00811</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#ab55b77950270df472006227e6594ae77">fit_to_cube</a>(T * &amp; img, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> * sz, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> * sz_target)
<a name="l00812"></a>00812 {
<a name="l00813"></a>00813     <span class="keywordflow">if</span> (!img || !sz || !sz_target)
<a name="l00814"></a>00814     {
<a name="l00815"></a>00815         fprintf(stderr, <span class="stringliteral">&quot;The input to fit_to_cube() are invalid [%s][%d].\n&quot;</span>, __FILE__, __LINE__);
<a name="l00816"></a>00816         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00817"></a>00817     }
<a name="l00818"></a>00818 
<a name="l00819"></a>00819     <span class="keywordflow">if</span> (sz[0]&lt;1 || sz[1]&lt;1 || sz[2]&lt;1 || sz[3]&lt;1 || sz[0]&gt;2048 || sz[1]&gt;2048 || sz[2]&gt;300 || sz[3]&gt;3)
<a name="l00820"></a>00820     {
<a name="l00821"></a>00821         fprintf(stderr, <span class="stringliteral">&quot;Input image size is not valid  [%s][%d].\n&quot;</span>, __FILE__, __LINE__);
<a name="l00822"></a>00822         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00823"></a>00823     }
<a name="l00824"></a>00824 
<a name="l00825"></a>00825     <span class="keywordflow">if</span> (sz_target[0]&lt;1 || sz_target[1]&lt;1 || sz_target[2]&lt;1 || sz_target[0]&gt;2048 || sz_target[1]&gt;2048 || sz_target[2]&gt;300)
<a name="l00826"></a>00826     {
<a name="l00827"></a>00827         fprintf(stderr, <span class="stringliteral">&quot;target image size is not valid  [%s][%d].\n&quot;</span>, __FILE__, __LINE__);
<a name="l00828"></a>00828         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00829"></a>00829     }
<a name="l00830"></a>00830 
<a name="l00831"></a>00831     T * outimg = <span class="keyword">new</span> T [sz_target[0] * sz_target[1] * sz_target[2] * sz[3]];
<a name="l00832"></a>00832     <span class="keywordflow">if</span> (!outimg)
<a name="l00833"></a>00833     {
<a name="l00834"></a>00834         fprintf(stderr, <span class="stringliteral">&quot;Fail to allocate memory. [%s][%d].\n&quot;</span>, __FILE__, __LINE__);
<a name="l00835"></a>00835         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00836"></a>00836     }
<a name="l00837"></a>00837 
<a name="l00838"></a>00838     T **** out_tmp4d = 0;
<a name="l00839"></a>00839     T **** in_tmp4d = 0;
<a name="l00840"></a>00840 
<a name="l00841"></a>00841     <a class="code" href="basic__memory_8cpp.html#a96857d4a852fd14c59d7f3185d95d628">new4dpointer</a>(out_tmp4d, sz_target[0], sz_target[1], sz_target[2], sz[3], outimg);
<a name="l00842"></a>00842     <a class="code" href="basic__memory_8cpp.html#a96857d4a852fd14c59d7f3185d95d628">new4dpointer</a>(in_tmp4d, sz[0], sz[1], sz[2], sz[3], img);
<a name="l00843"></a>00843 
<a name="l00844"></a>00844     <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> tmpi=0;tmpi&lt;(sz_target[0] * sz_target[1] * sz_target[2] * sz[3]); tmpi++) <span class="comment">//initialize to 0</span>
<a name="l00845"></a>00845     {
<a name="l00846"></a>00846         outimg[tmpi] = 0;
<a name="l00847"></a>00847     }
<a name="l00848"></a>00848 
<a name="l00849"></a>00849     <span class="comment">//for k</span>
<a name="l00850"></a>00850     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> src_k0, dst_k0, kmax;
<a name="l00851"></a>00851     <span class="keywordflow">if</span> (sz_target[2]&lt;sz[2])
<a name="l00852"></a>00852     {
<a name="l00853"></a>00853         src_k0=(sz[2]-sz_target[2])/2; dst_k0=0;
<a name="l00854"></a>00854         kmax = sz_target[2]-1;
<a name="l00855"></a>00855     }
<a name="l00856"></a>00856     <span class="keywordflow">else</span>
<a name="l00857"></a>00857     {
<a name="l00858"></a>00858         src_k0=0; dst_k0=(sz_target[2]-sz[2])/2;
<a name="l00859"></a>00859         kmax = sz[2]-1;
<a name="l00860"></a>00860     }
<a name="l00861"></a>00861 
<a name="l00862"></a>00862     <span class="comment">//for j</span>
<a name="l00863"></a>00863     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> src_j0, dst_j0, jmax;
<a name="l00864"></a>00864     <span class="keywordflow">if</span> (sz_target[1]&lt;sz[1])
<a name="l00865"></a>00865     {
<a name="l00866"></a>00866         src_j0=(sz[1]-sz_target[1])/2; dst_j0=0;
<a name="l00867"></a>00867         jmax = sz_target[1]-1;
<a name="l00868"></a>00868     }
<a name="l00869"></a>00869     <span class="keywordflow">else</span>
<a name="l00870"></a>00870     {
<a name="l00871"></a>00871         src_j0=0; dst_j0=(sz_target[1]-sz[1])/2;
<a name="l00872"></a>00872         jmax = sz[1]-1;
<a name="l00873"></a>00873     }
<a name="l00874"></a>00874 
<a name="l00875"></a>00875     <span class="comment">//for i</span>
<a name="l00876"></a>00876     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> src_i0, dst_i0, imax;
<a name="l00877"></a>00877     <span class="keywordflow">if</span> (sz_target[0]&lt;sz[0])
<a name="l00878"></a>00878     {
<a name="l00879"></a>00879         src_i0=(sz[0]-sz_target[0])/2; dst_i0=0;
<a name="l00880"></a>00880         imax = sz_target[0]-1;
<a name="l00881"></a>00881     }
<a name="l00882"></a>00882     <span class="keywordflow">else</span>
<a name="l00883"></a>00883     {
<a name="l00884"></a>00884         src_i0=0; dst_i0=(sz_target[0]-sz[0])/2;
<a name="l00885"></a>00885         imax = sz[0]-1;
<a name="l00886"></a>00886     }
<a name="l00887"></a>00887 
<a name="l00888"></a>00888 
<a name="l00889"></a>00889     <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> c=0;c&lt;sz[3];c++)
<a name="l00890"></a>00890     {
<a name="l00891"></a>00891         <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> k=0;k&lt;=kmax;k++)
<a name="l00892"></a>00892         {
<a name="l00893"></a>00893             <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> j=0;j&lt;=jmax;j++)
<a name="l00894"></a>00894             {
<a name="l00895"></a>00895                 <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i=0;i&lt;=imax;i++)
<a name="l00896"></a>00896                 {
<a name="l00897"></a>00897                     out_tmp4d[c][k+dst_k0][j+dst_j0][i+dst_i0] = in_tmp4d[c][k+src_k0][j+src_j0][i+src_i0];
<a name="l00898"></a>00898                 }
<a name="l00899"></a>00899             }
<a name="l00900"></a>00900         }
<a name="l00901"></a>00901     }
<a name="l00902"></a>00902 
<a name="l00903"></a>00903     <span class="comment">//delete temprary 4d pointers</span>
<a name="l00904"></a>00904 
<a name="l00905"></a>00905     <a class="code" href="basic__memory_8cpp.html#a9a618ed1cf82c3991d68e2d4e0f840e0">delete4dpointer</a>(out_tmp4d, sz_target[0], sz_target[1], sz_target[2], sz[3]);
<a name="l00906"></a>00906     <a class="code" href="basic__memory_8cpp.html#a9a618ed1cf82c3991d68e2d4e0f840e0">delete4dpointer</a>(in_tmp4d, sz[0], sz[1], sz[2], sz[3]);
<a name="l00907"></a>00907 
<a name="l00908"></a>00908     <span class="comment">//copy to output data</span>
<a name="l00909"></a>00909 
<a name="l00910"></a>00910     <span class="keyword">delete</span> []img;
<a name="l00911"></a>00911     img = outimg;
<a name="l00912"></a>00912 
<a name="l00913"></a>00913     sz[0] = sz_target[0];
<a name="l00914"></a>00914     sz[1] = sz_target[1];
<a name="l00915"></a>00915     sz[2] = sz_target[2];
<a name="l00916"></a>00916     sz[3] = sz[3];
<a name="l00917"></a>00917 
<a name="l00918"></a>00918     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00919"></a>00919 }
<a name="l00920"></a>00920 
<a name="l00921"></a>00921 
<a name="l00922"></a>00922 <span class="comment">//down-sampling data volume</span>
<a name="l00923"></a><a class="code" href="volimg__proc__declare_8h.html#a36a4eb4af341c785db1405f7bcd4f53f">00923</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#a36a4eb4af341c785db1405f7bcd4f53f">downsample3dimg_1dpt</a>(T * &amp; img, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> * sz, <span class="keywordtype">double</span> dfactor)
<a name="l00924"></a>00924 {
<a name="l00925"></a>00925     <span class="keywordflow">if</span> (!img || !sz)
<a name="l00926"></a>00926     {
<a name="l00927"></a>00927         fprintf(stderr, <span class="stringliteral">&quot;The input to downsample3dimg_1dpt() are invalid [%s][%d].\n&quot;</span>, __FILE__, __LINE__);
<a name="l00928"></a>00928         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00929"></a>00929     }
<a name="l00930"></a>00930 
<a name="l00931"></a>00931     <span class="keywordflow">if</span> (<span class="keywordtype">int</span>(dfactor)&lt;1 || <span class="keywordtype">int</span>(dfactor)&gt;16)
<a name="l00932"></a>00932     {
<a name="l00933"></a>00933         fprintf(stderr, <span class="stringliteral">&quot;The downsampling factor must be &gt;=1 and &lt;= 16 [%s][%d] dfactor=%.2f.\n&quot;</span>, __FILE__, __LINE__, dfactor);
<a name="l00934"></a>00934         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00935"></a>00935     }
<a name="l00936"></a>00936 
<a name="l00937"></a>00937     <span class="keywordflow">if</span> (sz[0]&lt;1 || sz[1]&lt;1 || sz[2]&lt;1 || sz[3]&lt;1 || sz[0]&gt;2048 || sz[1]&gt;2048 || sz[2]&gt;300 || sz[3]&gt;3)
<a name="l00938"></a>00938     {
<a name="l00939"></a>00939         fprintf(stderr, <span class="stringliteral">&quot;Input image size is not valid .\n&quot;</span>, __FILE__, __LINE__, dfactor);
<a name="l00940"></a>00940         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00941"></a>00941     }
<a name="l00942"></a>00942 
<a name="l00943"></a>00943     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> cur_sz0 = (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>)(<a class="code" href="vcdiff_8cpp.html#a65f0d7631e66c9e030328c8de8059738">floor</a>(<span class="keywordtype">double</span>(sz[0]) / <span class="keywordtype">double</span>(dfactor)));
<a name="l00944"></a>00944     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> cur_sz1 = (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>)(<a class="code" href="vcdiff_8cpp.html#a65f0d7631e66c9e030328c8de8059738">floor</a>(<span class="keywordtype">double</span>(sz[1]) / double(dfactor)));
<a name="l00945"></a>00945     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> cur_sz2 = sz[2];
<a name="l00946"></a>00946     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> cur_sz3 = sz[3];
<a name="l00947"></a>00947 
<a name="l00948"></a>00948     <span class="keywordflow">if</span> (cur_sz0 &lt;= 0 || cur_sz1 &lt;=0 || cur_sz2&lt;=0 || cur_sz3&lt;=0)
<a name="l00949"></a>00949     {
<a name="l00950"></a>00950         fprintf(stderr, <span class="stringliteral">&quot;The dfactor is not properly set, -- the resulted downsampled size is too small. Do nothing. [%s][%d].\n&quot;</span>, __FILE__, __LINE__);
<a name="l00951"></a>00951         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00952"></a>00952     }
<a name="l00953"></a>00953 
<a name="l00954"></a>00954     T * outimg = <span class="keyword">new</span> T [cur_sz0 * cur_sz1 * cur_sz2 * cur_sz3];
<a name="l00955"></a>00955     <span class="keywordflow">if</span> (!outimg)
<a name="l00956"></a>00956     {
<a name="l00957"></a>00957         fprintf(stderr, <span class="stringliteral">&quot;Fail to allocate memory. [%s][%d].\n&quot;</span>, __FILE__, __LINE__);
<a name="l00958"></a>00958         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00959"></a>00959     }
<a name="l00960"></a>00960 
<a name="l00961"></a>00961     T **** out_tmp4d = 0;
<a name="l00962"></a>00962     T **** in_tmp4d = 0;
<a name="l00963"></a>00963 
<a name="l00964"></a>00964     <a class="code" href="basic__memory_8cpp.html#a96857d4a852fd14c59d7f3185d95d628">new4dpointer</a>(out_tmp4d, cur_sz0, cur_sz1, cur_sz2, cur_sz3, outimg);
<a name="l00965"></a>00965     <a class="code" href="basic__memory_8cpp.html#a96857d4a852fd14c59d7f3185d95d628">new4dpointer</a>(in_tmp4d, sz[0], sz[1], sz[2], sz[3], img);
<a name="l00966"></a>00966 
<a name="l00967"></a>00967     <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> c=0;c&lt;cur_sz3;c++)
<a name="l00968"></a>00968     {
<a name="l00969"></a>00969         <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> k=0;k&lt;cur_sz2;k++)
<a name="l00970"></a>00970         {
<a name="l00971"></a>00971             <span class="comment">//V3DLONG k2low=V3DLONG(floor(k*dfactor)), k2high=V3DLONG(floor((k+1)*dfactor-1));</span>
<a name="l00972"></a>00972             <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> k2low=k, k2high=k; <span class="comment">//do not downsampling z, 070927</span>
<a name="l00973"></a>00973             <span class="keywordflow">if</span> (k2high&gt;sz[2]-1) k2high = sz[2]-1;
<a name="l00974"></a>00974             <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> kw = k2high - k2low + 1;
<a name="l00975"></a>00975 
<a name="l00976"></a>00976             <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> j=0;j&lt;cur_sz1;j++)
<a name="l00977"></a>00977             {
<a name="l00978"></a>00978                 <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> j2low=<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>(<a class="code" href="vcdiff_8cpp.html#a65f0d7631e66c9e030328c8de8059738">floor</a>(j*dfactor)), j2high=<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>(<a class="code" href="vcdiff_8cpp.html#a65f0d7631e66c9e030328c8de8059738">floor</a>((j+1)*dfactor-1));
<a name="l00979"></a>00979                 <span class="keywordflow">if</span> (j2high&gt;sz[1]-1) j2high = sz[1]-1;
<a name="l00980"></a>00980                 <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> jw = j2high - j2low + 1;
<a name="l00981"></a>00981 
<a name="l00982"></a>00982                 <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i=0;i&lt;cur_sz0;i++)
<a name="l00983"></a>00983                 {
<a name="l00984"></a>00984                     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i2low=<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>(<a class="code" href="vcdiff_8cpp.html#a65f0d7631e66c9e030328c8de8059738">floor</a>(i*dfactor)), i2high=<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>(<a class="code" href="vcdiff_8cpp.html#a65f0d7631e66c9e030328c8de8059738">floor</a>((i+1)*dfactor-1));
<a name="l00985"></a>00985                     <span class="keywordflow">if</span> (i2high&gt;sz[0]-1) i2high = sz[0]-1;
<a name="l00986"></a>00986                     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> iw = i2high - i2low + 1;
<a name="l00987"></a>00987 
<a name="l00988"></a>00988                     <span class="keywordtype">double</span> cubevolume = double(kw) * jw * iw;
<a name="l00989"></a>00989                     <span class="comment">//cout&lt;&lt;cubevolume &lt;&lt;&quot; &quot;;</span>
<a name="l00990"></a>00990 
<a name="l00991"></a>00991                     <span class="keywordtype">double</span> s=0.0;
<a name="l00992"></a>00992                     <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> k1=k2low;k1&lt;=k2high;k1++)
<a name="l00993"></a>00993                     {
<a name="l00994"></a>00994                         <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> j1=j2low;j1&lt;=j2high;j1++)
<a name="l00995"></a>00995                         {
<a name="l00996"></a>00996                             <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i1=i2low;i1&lt;=i2high;i1++)
<a name="l00997"></a>00997                             {
<a name="l00998"></a>00998                                 s += in_tmp4d[c][k1][j1][i1];
<a name="l00999"></a>00999                             }
<a name="l01000"></a>01000                         }
<a name="l01001"></a>01001                     }
<a name="l01002"></a>01002 
<a name="l01003"></a>01003                     out_tmp4d[c][k][j][i] = (T)(s/cubevolume);
<a name="l01004"></a>01004                 }
<a name="l01005"></a>01005             }
<a name="l01006"></a>01006         }
<a name="l01007"></a>01007     }
<a name="l01008"></a>01008 
<a name="l01009"></a>01009     <span class="comment">//delete temprary 4d pointers</span>
<a name="l01010"></a>01010 
<a name="l01011"></a>01011     <a class="code" href="basic__memory_8cpp.html#a9a618ed1cf82c3991d68e2d4e0f840e0">delete4dpointer</a>(out_tmp4d, cur_sz0, cur_sz1, cur_sz2, cur_sz3);
<a name="l01012"></a>01012     <a class="code" href="basic__memory_8cpp.html#a9a618ed1cf82c3991d68e2d4e0f840e0">delete4dpointer</a>(in_tmp4d, sz[0], sz[1], sz[2], sz[3]);
<a name="l01013"></a>01013 
<a name="l01014"></a>01014     <span class="comment">//copy to output data</span>
<a name="l01015"></a>01015 
<a name="l01016"></a>01016     <span class="keyword">delete</span> []img;
<a name="l01017"></a>01017     img = outimg;
<a name="l01018"></a>01018 
<a name="l01019"></a>01019     sz[0] = cur_sz0;
<a name="l01020"></a>01020     sz[1] = cur_sz1;
<a name="l01021"></a>01021     sz[2] = cur_sz2;
<a name="l01022"></a>01022     sz[3] = cur_sz3;
<a name="l01023"></a>01023 
<a name="l01024"></a>01024     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01025"></a>01025 }
<a name="l01026"></a>01026 
<a name="l01027"></a>01027 
<a name="l01028"></a>01028 <span class="comment">//simple nearest neighbor reslicing of a 3D stack</span>
<a name="l01029"></a>01029 
<a name="l01030"></a><a class="code" href="volimg__proc_8h.html#ab76e697976fd2c80f77ec40c6997f276">01030</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#ab76e697976fd2c80f77ec40c6997f276">reslice_Z</a>(T * &amp; invol1d, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> * sz, <span class="keywordtype">double</span> xy_rez, <span class="keywordtype">double</span> z_rez, <span class="keywordtype">int</span> interp_method)
<a name="l01031"></a>01031 {
<a name="l01032"></a>01032   <span class="comment">//check if parameters are correct</span>
<a name="l01033"></a>01033 
<a name="l01034"></a>01034   <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j,k,c;
<a name="l01035"></a>01035 
<a name="l01036"></a>01036   <span class="comment">//get image</span>
<a name="l01037"></a>01037 
<a name="l01038"></a>01038   <span class="keywordflow">if</span> (!invol1d || sz[0]*sz[1]*sz[2]*sz[3]&lt;=0 || xy_rez&lt;=0 || z_rez&lt;=0)
<a name="l01039"></a>01039   {
<a name="l01040"></a>01040     fprintf(stderr,<span class="stringliteral">&quot;You have provided illgeal parameters to reslice_Z().\n&quot;</span>);
<a name="l01041"></a>01041     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01042"></a>01042   }
<a name="l01043"></a>01043 
<a name="l01044"></a>01044   <span class="keywordflow">if</span> (interp_method!=0 &amp;&amp; interp_method!=1) <span class="comment">//0 for nearest neighbor interp and 1 for linear</span>
<a name="l01045"></a>01045   {
<a name="l01046"></a>01046     fprintf(stderr,<span class="stringliteral">&quot;You have provided illgeal interp_method parameters to reslice_Z() [you pass a code %d].\n&quot;</span>, interp_method);
<a name="l01047"></a>01047     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01048"></a>01048   }
<a name="l01049"></a>01049 
<a name="l01050"></a>01050 
<a name="l01051"></a>01051   <span class="comment">//==================== set up the input and output volume matrix =====================</span>
<a name="l01052"></a>01052 
<a name="l01053"></a>01053   <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> xlen_out = sz[0];
<a name="l01054"></a>01054   <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> ylen_out = sz[1];
<a name="l01055"></a>01055   <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> zlen_out = <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>((<span class="keywordtype">double</span>(sz[2]) * z_rez)/xy_rez + 0.5); <span class="comment">//if use ceil() then rish having no value at the border //remove sz[2]-1 on 100831, by PHC</span>
<a name="l01056"></a>01056   <span class="keywordtype">double</span> z_rez_new = xy_rez;
<a name="l01057"></a>01057   <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> clen_out = sz[3];
<a name="l01058"></a>01058 
<a name="l01059"></a>01059   T * outvol1d = <span class="keyword">new</span> T [xlen_out*ylen_out*zlen_out*clen_out];
<a name="l01060"></a>01060   <span class="keywordflow">if</span> (!outvol1d)
<a name="l01061"></a>01061   {
<a name="l01062"></a>01062     fprintf(stderr,<span class="stringliteral">&quot;Fail to allocate memory for the output volume 1d in reslice_Z().\n&quot;</span>);
<a name="l01063"></a>01063     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01064"></a>01064   }
<a name="l01065"></a>01065 
<a name="l01066"></a>01066   T **** outvol4d=0, ****invol4d=0;
<a name="l01067"></a>01067   <a class="code" href="basic__memory_8cpp.html#a96857d4a852fd14c59d7f3185d95d628">new4dpointer</a>(invol4d, sz[0], sz[1], sz[2], sz[3], invol1d);
<a name="l01068"></a>01068   <a class="code" href="basic__memory_8cpp.html#a96857d4a852fd14c59d7f3185d95d628">new4dpointer</a>(outvol4d, xlen_out, ylen_out, zlen_out, clen_out, outvol1d);
<a name="l01069"></a>01069   <span class="keywordflow">if</span> (!invol4d || !outvol4d)
<a name="l01070"></a>01070   {
<a name="l01071"></a>01071     <span class="keywordflow">if</span> (invol4d) {<a class="code" href="basic__memory_8cpp.html#a9a618ed1cf82c3991d68e2d4e0f840e0">delete4dpointer</a>(invol4d, sz[0], sz[1], sz[2], sz[3]); invol4d=0;}
<a name="l01072"></a>01072     <span class="keywordflow">if</span> (outvol4d) {<a class="code" href="basic__memory_8cpp.html#a9a618ed1cf82c3991d68e2d4e0f840e0">delete4dpointer</a>(outvol4d, xlen_out, ylen_out, zlen_out, clen_out); outvol4d=0;}
<a name="l01073"></a>01073     fprintf(stderr,<span class="stringliteral">&quot;Fail to allocate memory for the input/output volumes 4d in reslice_Z().\n&quot;</span>);
<a name="l01074"></a>01074     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01075"></a>01075   }
<a name="l01076"></a>01076 
<a name="l01077"></a>01077   printf(<span class="stringliteral">&quot;#original slice=%ld original rez=%6.5f -&gt; #output slices=%ld new rez=%6.5f\n&quot;</span>, sz[2], z_rez, zlen_out, z_rez_new);
<a name="l01078"></a>01078   <span class="comment">//return;</span>
<a name="l01079"></a>01079 
<a name="l01080"></a>01080   <span class="comment">//============ generate linear interpolation ===================</span>
<a name="l01081"></a>01081 
<a name="l01082"></a>01082   <span class="keywordflow">if</span> (interp_method==1) <span class="comment">//linear interp</span>
<a name="l01083"></a>01083   {
<a name="l01084"></a>01084       <span class="keywordflow">for</span> (c=0; c&lt;clen_out; c++)
<a name="l01085"></a>01085       {
<a name="l01086"></a>01086           <span class="keywordflow">for</span> (i=0; i&lt;zlen_out; i++)
<a name="l01087"></a>01087           {
<a name="l01088"></a>01088               <span class="keywordtype">double</span> curpz = double(i)*z_rez_new/z_rez;
<a name="l01089"></a>01089               <span class="keywordflow">if</span> (curpz&gt;=sz[2]-1) curpz=sz[2]-1; <span class="comment">//100831, by PHC</span>
<a name="l01090"></a>01090               
<a name="l01091"></a>01091               <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> cpz0 = (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>)(<a class="code" href="vcdiff_8cpp.html#a65f0d7631e66c9e030328c8de8059738">floor</a>(curpz)), cpz1 = (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>)(ceil(curpz));
<a name="l01092"></a>01092 
<a name="l01093"></a>01093               <span class="keywordflow">if</span> (cpz0==cpz1)
<a name="l01094"></a>01094               {
<a name="l01095"></a>01095                   <span class="keywordflow">for</span> (j=0;j&lt;ylen_out; j++)
<a name="l01096"></a>01096                   {
<a name="l01097"></a>01097                     <span class="keywordflow">for</span> (k=0; k&lt;xlen_out; k++)
<a name="l01098"></a>01098                     {
<a name="l01099"></a>01099                         outvol4d[c][i][j][k] = invol4d[c][cpz0][j][k];
<a name="l01100"></a>01100                     }
<a name="l01101"></a>01101                   }
<a name="l01102"></a>01102               }
<a name="l01103"></a>01103               <span class="keywordflow">else</span>
<a name="l01104"></a>01104               {
<a name="l01105"></a>01105                   <span class="keywordtype">double</span> w0z = (cpz1-curpz);
<a name="l01106"></a>01106                   <span class="keywordtype">double</span> w1z = (curpz-cpz0);
<a name="l01107"></a>01107 
<a name="l01108"></a>01108                   <span class="keywordflow">for</span> (j=0;j&lt;ylen_out; j++)
<a name="l01109"></a>01109                   {
<a name="l01110"></a>01110                     <span class="keywordflow">for</span> (k=0; k&lt;xlen_out; k++)
<a name="l01111"></a>01111                     {
<a name="l01112"></a>01112                         outvol4d[c][i][j][k] = (T)(w0z * <span class="keywordtype">double</span>(invol4d[c][cpz0][j][k]) + w1z * double(invol4d[c][cpz1][j][k]));
<a name="l01113"></a>01113                     }
<a name="l01114"></a>01114                   }
<a name="l01115"></a>01115               }
<a name="l01116"></a>01116 
<a name="l01117"></a>01117           }
<a name="l01118"></a>01118       }
<a name="l01119"></a>01119   }
<a name="l01120"></a>01120   <span class="keywordflow">else</span> <span class="comment">//nearest neighbor interp</span>
<a name="l01121"></a>01121   {
<a name="l01122"></a>01122       <span class="keywordflow">for</span> (c=0; c&lt;clen_out; c++)
<a name="l01123"></a>01123       {
<a name="l01124"></a>01124           <span class="keywordflow">for</span> (i=0; i&lt;zlen_out; i++)
<a name="l01125"></a>01125           {
<a name="l01126"></a>01126               <span class="keywordtype">double</span> curpz = double(i)*z_rez_new/z_rez;
<a name="l01127"></a>01127               <span class="keywordflow">if</span> (curpz&gt;=sz[2]-1) curpz=sz[2]-1; <span class="comment">//100831, by PHC</span>
<a name="l01128"></a>01128 
<a name="l01129"></a>01129               <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> cpz0 = (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>)(<a class="code" href="vcdiff_8cpp.html#a65f0d7631e66c9e030328c8de8059738">floor</a>(curpz)), cpz1 = (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>)(ceil(curpz));
<a name="l01130"></a>01130 
<a name="l01131"></a>01131               <span class="keywordflow">if</span> (cpz0==cpz1)
<a name="l01132"></a>01132               {
<a name="l01133"></a>01133                   <span class="keywordflow">for</span> (j=0;j&lt;ylen_out; j++)
<a name="l01134"></a>01134                   {
<a name="l01135"></a>01135                     <span class="keywordflow">for</span> (k=0; k&lt;xlen_out; k++)
<a name="l01136"></a>01136                     {
<a name="l01137"></a>01137                         outvol4d[c][i][j][k] = invol4d[c][cpz0][j][k];
<a name="l01138"></a>01138                     }
<a name="l01139"></a>01139                   }
<a name="l01140"></a>01140               }
<a name="l01141"></a>01141               <span class="keywordflow">else</span>
<a name="l01142"></a>01142               {
<a name="l01143"></a>01143                   <span class="keywordtype">double</span> w0z = (cpz1-curpz);
<a name="l01144"></a>01144                   <span class="keywordtype">double</span> w1z = (curpz-cpz0);
<a name="l01145"></a>01145 
<a name="l01146"></a>01146                   <span class="keywordflow">if</span> (w0z&gt;=w1z) <span class="comment">//note &gt;= condition so that to handle the case of x2 zoom-in</span>
<a name="l01147"></a>01147                   {
<a name="l01148"></a>01148                       <span class="keywordflow">for</span> (j=0;j&lt;ylen_out; j++)
<a name="l01149"></a>01149                       {
<a name="l01150"></a>01150                         <span class="keywordflow">for</span> (k=0; k&lt;xlen_out; k++)
<a name="l01151"></a>01151                         {
<a name="l01152"></a>01152                             outvol4d[c][i][j][k] = invol4d[c][cpz0][j][k];
<a name="l01153"></a>01153                         }
<a name="l01154"></a>01154                       }
<a name="l01155"></a>01155                   }
<a name="l01156"></a>01156                   <span class="keywordflow">else</span>
<a name="l01157"></a>01157                   {
<a name="l01158"></a>01158                       <span class="keywordflow">for</span> (j=0;j&lt;ylen_out; j++)
<a name="l01159"></a>01159                       {
<a name="l01160"></a>01160                         <span class="keywordflow">for</span> (k=0; k&lt;xlen_out; k++)
<a name="l01161"></a>01161                         {
<a name="l01162"></a>01162                             outvol4d[c][i][j][k] = invol4d[c][cpz1][j][k];
<a name="l01163"></a>01163                         }
<a name="l01164"></a>01164                       }
<a name="l01165"></a>01165                   }
<a name="l01166"></a>01166               }
<a name="l01167"></a>01167           }
<a name="l01168"></a>01168       }
<a name="l01169"></a>01169   }
<a name="l01170"></a>01170 
<a name="l01171"></a>01171   <span class="comment">// ====free memory=============</span>
<a name="l01172"></a>01172   <span class="keywordflow">if</span> (invol4d) {<a class="code" href="basic__memory_8cpp.html#a9a618ed1cf82c3991d68e2d4e0f840e0">delete4dpointer</a>(invol4d, sz[0], sz[1], sz[2], sz[3]); invol4d=0;}
<a name="l01173"></a>01173   <span class="keywordflow">if</span> (outvol4d) {<a class="code" href="basic__memory_8cpp.html#a9a618ed1cf82c3991d68e2d4e0f840e0">delete4dpointer</a>(outvol4d, xlen_out, ylen_out, zlen_out, clen_out); outvol4d=0;}
<a name="l01174"></a>01174 
<a name="l01175"></a>01175   <span class="comment">//update the output pointer and size of Z</span>
<a name="l01176"></a>01176   <span class="keyword">delete</span> []invol1d;
<a name="l01177"></a>01177   invol1d = outvol1d;
<a name="l01178"></a>01178 
<a name="l01179"></a>01179   sz[2] = zlen_out;
<a name="l01180"></a>01180 
<a name="l01181"></a>01181   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01182"></a>01182 }
<a name="l01183"></a>01183 
<a name="l01184"></a>01184 <span class="comment">//re-sampling data volume with different scaling factors of different axes</span>
<a name="l01185"></a><a class="code" href="volimg__proc_8h.html#a36cdc66902fc0fb456483b367dbc5cac">01185</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="volimg__proc_8h.html#a36cdc66902fc0fb456483b367dbc5cac">resample3dimg_interp</a>(T * &amp; img, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> * sz, <span class="keywordtype">double</span> dfactor_x, <span class="keywordtype">double</span> dfactor_y, <span class="keywordtype">double</span> dfactor_z, <span class="keywordtype">int</span> interp_method)
<a name="l01186"></a>01186 {
<a name="l01187"></a>01187     <span class="keywordflow">if</span> (!img || !sz)
<a name="l01188"></a>01188     {
<a name="l01189"></a>01189         fprintf(stderr, <span class="stringliteral">&quot;The input to resample3dimg_interp() are invalid [%s][%d].\n&quot;</span>, __FILE__, __LINE__);
<a name="l01190"></a>01190         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01191"></a>01191     }
<a name="l01192"></a>01192 
<a name="l01193"></a>01193     <span class="keywordflow">if</span> (dfactor_x&lt;1 || dfactor_y&lt;1 || dfactor_z&lt;1)
<a name="l01194"></a>01194     {
<a name="l01195"></a>01195         fprintf(stderr, <span class="stringliteral">&quot;The resampling factor must be &gt;1 in resample3dimg_linear_interp(), because now only DOWN-sampling is supported [%s][%d].\n&quot;</span>, __FILE__, __LINE__);
<a name="l01196"></a>01196         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01197"></a>01197     }
<a name="l01198"></a>01198 
<a name="l01199"></a>01199     <span class="keywordflow">if</span> (sz[0]&lt;1 || sz[1]&lt;1 || sz[2]&lt;1 || sz[3]&lt;1)
<a name="l01200"></a>01200     {
<a name="l01201"></a>01201         fprintf(stderr, <span class="stringliteral">&quot;Input image size is not valid in resample3dimg_interp() [%s][%d].\n&quot;</span>, __FILE__, __LINE__);
<a name="l01202"></a>01202         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01203"></a>01203     }
<a name="l01204"></a>01204 
<a name="l01205"></a>01205     <span class="keywordflow">if</span> (interp_method!=1) <span class="comment">//0 for nearest neighbor interp and 1 for linear</span>
<a name="l01206"></a>01206     {
<a name="l01207"></a>01207         fprintf(stderr,<span class="stringliteral">&quot;Invalid interpolation code. Now only linear interpolation is supported in  resample3dimg_linear_interp() [you pass a code %d].\n&quot;</span>, interp_method);
<a name="l01208"></a>01208         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01209"></a>01209     }
<a name="l01210"></a>01210 
<a name="l01211"></a>01211     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> cur_sz0 = (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>)(<a class="code" href="vcdiff_8cpp.html#a65f0d7631e66c9e030328c8de8059738">floor</a>(<span class="keywordtype">double</span>(sz[0]) / <span class="keywordtype">double</span>(dfactor_x)));
<a name="l01212"></a>01212     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> cur_sz1 = (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>)(<a class="code" href="vcdiff_8cpp.html#a65f0d7631e66c9e030328c8de8059738">floor</a>(<span class="keywordtype">double</span>(sz[1]) / double(dfactor_y)));
<a name="l01213"></a>01213     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> cur_sz2 = (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>)(<a class="code" href="vcdiff_8cpp.html#a65f0d7631e66c9e030328c8de8059738">floor</a>(<span class="keywordtype">double</span>(sz[2]) / double(dfactor_z)));
<a name="l01214"></a>01214     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> cur_sz3 = sz[3];
<a name="l01215"></a>01215 
<a name="l01216"></a>01216     <span class="keywordflow">if</span> (cur_sz0 &lt;= 0 || cur_sz1 &lt;=0 || cur_sz2&lt;=0 || cur_sz3&lt;=0)
<a name="l01217"></a>01217     {
<a name="l01218"></a>01218         fprintf(stderr, <span class="stringliteral">&quot;The dfactors are not properly set, -- the resulted resampled size is too small. Do nothing. [%s][%d].\n&quot;</span>, __FILE__, __LINE__);
<a name="l01219"></a>01219         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01220"></a>01220     }
<a name="l01221"></a>01221 
<a name="l01222"></a>01222     T * outimg = <span class="keyword">new</span> T [cur_sz0 * cur_sz1 * cur_sz2 * cur_sz3];
<a name="l01223"></a>01223     <span class="keywordflow">if</span> (!outimg)
<a name="l01224"></a>01224     {
<a name="l01225"></a>01225         fprintf(stderr, <span class="stringliteral">&quot;Fail to allocate memory. [%s][%d].\n&quot;</span>, __FILE__, __LINE__);
<a name="l01226"></a>01226         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01227"></a>01227     }
<a name="l01228"></a>01228 
<a name="l01229"></a>01229     T **** out_tmp4d = 0;
<a name="l01230"></a>01230     T **** in_tmp4d = 0;
<a name="l01231"></a>01231 
<a name="l01232"></a>01232     <a class="code" href="basic__memory_8cpp.html#a96857d4a852fd14c59d7f3185d95d628">new4dpointer</a>(out_tmp4d, cur_sz0, cur_sz1, cur_sz2, cur_sz3, outimg);
<a name="l01233"></a>01233     <a class="code" href="basic__memory_8cpp.html#a96857d4a852fd14c59d7f3185d95d628">new4dpointer</a>(in_tmp4d, sz[0], sz[1], sz[2], sz[3], img);
<a name="l01234"></a>01234 
<a name="l01235"></a>01235     <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> c=0;c&lt;cur_sz3;c++)
<a name="l01236"></a>01236     {
<a name="l01237"></a>01237         <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> k=0;k&lt;cur_sz2;k++)
<a name="l01238"></a>01238         {
<a name="l01239"></a>01239             <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> k2low=(<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>)(<a class="code" href="vcdiff_8cpp.html#a65f0d7631e66c9e030328c8de8059738">floor</a>(k*dfactor_z)), k2high=(<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>)(<a class="code" href="vcdiff_8cpp.html#a65f0d7631e66c9e030328c8de8059738">floor</a>((k+1)*dfactor_z-1));
<a name="l01240"></a>01240             <span class="keywordflow">if</span> (k2high&gt;sz[2]-1) k2high = sz[2]-1;
<a name="l01241"></a>01241             <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> kw = k2high - k2low + 1;
<a name="l01242"></a>01242 
<a name="l01243"></a>01243             <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> j=0;j&lt;cur_sz1;j++)
<a name="l01244"></a>01244             {
<a name="l01245"></a>01245                 <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> j2low=(<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>)(<a class="code" href="vcdiff_8cpp.html#a65f0d7631e66c9e030328c8de8059738">floor</a>(j*dfactor_y)), j2high=(<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>)(<a class="code" href="vcdiff_8cpp.html#a65f0d7631e66c9e030328c8de8059738">floor</a>((j+1)*dfactor_y-1));
<a name="l01246"></a>01246                 <span class="keywordflow">if</span> (j2high&gt;sz[1]-1) j2high = sz[1]-1;
<a name="l01247"></a>01247                 <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> jw = j2high - j2low + 1;
<a name="l01248"></a>01248 
<a name="l01249"></a>01249                 <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i=0;i&lt;cur_sz0;i++)
<a name="l01250"></a>01250                 {
<a name="l01251"></a>01251                     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i2low=(<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>)(<a class="code" href="vcdiff_8cpp.html#a65f0d7631e66c9e030328c8de8059738">floor</a>(i*dfactor_x)), i2high=(<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>)(<a class="code" href="vcdiff_8cpp.html#a65f0d7631e66c9e030328c8de8059738">floor</a>((i+1)*dfactor_x-1));
<a name="l01252"></a>01252                     <span class="keywordflow">if</span> (i2high&gt;sz[0]-1) i2high = sz[0]-1;
<a name="l01253"></a>01253                     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> iw = i2high - i2low + 1;
<a name="l01254"></a>01254 
<a name="l01255"></a>01255                     <span class="keywordtype">double</span> cubevolume = double(kw) * jw * iw;
<a name="l01256"></a>01256                     <span class="comment">//cout&lt;&lt;cubevolume &lt;&lt;&quot; &quot;;</span>
<a name="l01257"></a>01257 
<a name="l01258"></a>01258                     <span class="keywordtype">double</span> s=0.0;
<a name="l01259"></a>01259                     <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> k1=k2low;k1&lt;=k2high;k1++)
<a name="l01260"></a>01260                     {
<a name="l01261"></a>01261                         <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> j1=j2low;j1&lt;=j2high;j1++)
<a name="l01262"></a>01262                         {
<a name="l01263"></a>01263                             <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i1=i2low;i1&lt;=i2high;i1++)
<a name="l01264"></a>01264                             {
<a name="l01265"></a>01265                                 s += in_tmp4d[c][k1][j1][i1];
<a name="l01266"></a>01266                             }
<a name="l01267"></a>01267                         }
<a name="l01268"></a>01268                     }
<a name="l01269"></a>01269 
<a name="l01270"></a>01270                     out_tmp4d[c][k][j][i] = (T)(s/cubevolume);
<a name="l01271"></a>01271                 }
<a name="l01272"></a>01272             }
<a name="l01273"></a>01273         }
<a name="l01274"></a>01274     }
<a name="l01275"></a>01275 
<a name="l01276"></a>01276     <span class="comment">//delete temprary 4d pointers</span>
<a name="l01277"></a>01277 
<a name="l01278"></a>01278     <a class="code" href="basic__memory_8cpp.html#a9a618ed1cf82c3991d68e2d4e0f840e0">delete4dpointer</a>(out_tmp4d, cur_sz0, cur_sz1, cur_sz2, cur_sz3);
<a name="l01279"></a>01279     <a class="code" href="basic__memory_8cpp.html#a9a618ed1cf82c3991d68e2d4e0f840e0">delete4dpointer</a>(in_tmp4d, sz[0], sz[1], sz[2], sz[3]);
<a name="l01280"></a>01280 
<a name="l01281"></a>01281     <span class="comment">//copy to output data</span>
<a name="l01282"></a>01282 
<a name="l01283"></a>01283     <span class="keyword">delete</span> []img;
<a name="l01284"></a>01284     img = outimg;
<a name="l01285"></a>01285 
<a name="l01286"></a>01286     sz[0] = cur_sz0;
<a name="l01287"></a>01287     sz[1] = cur_sz1;
<a name="l01288"></a>01288     sz[2] = cur_sz2;
<a name="l01289"></a>01289     sz[3] = cur_sz3;
<a name="l01290"></a>01290 
<a name="l01291"></a>01291     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01292"></a>01292 }
<a name="l01293"></a>01293 
<a name="l01294"></a><a class="code" href="volimg__proc__declare_8h.html#a41baf871860b04c21cbca21ba84a729f">01294</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">double</span> <a class="code" href="volimg__proc_8h.html#a41baf871860b04c21cbca21ba84a729f">calCorrelation</a>(T * img1, T * img2, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> imglen)
<a name="l01295"></a>01295 {
<a name="l01296"></a>01296   <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> i,j;
<a name="l01297"></a>01297   <span class="keywordtype">double</span> s12=0, s11=0, s22=0;
<a name="l01298"></a>01298   <span class="keywordtype">double</span> m11=0, m22=0;
<a name="l01299"></a>01299 
<a name="l01300"></a>01300   <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> n=0;
<a name="l01301"></a>01301   <span class="keywordflow">for</span> (i=0;i&lt;imglen;i++)
<a name="l01302"></a>01302   {
<a name="l01303"></a>01303     m11 += double(img1[i]);
<a name="l01304"></a>01304     m22 += double(img2[i]);
<a name="l01305"></a>01305     n++;
<a name="l01306"></a>01306   }
<a name="l01307"></a>01307   m11 /= double(n);
<a name="l01308"></a>01308   m22 /= double(n);
<a name="l01309"></a>01309 
<a name="l01310"></a>01310   <span class="keywordtype">double</span> tmp1, tmp2;
<a name="l01311"></a>01311   <span class="keywordflow">for</span> (i=0;i&lt;imglen;i++)
<a name="l01312"></a>01312   {
<a name="l01313"></a>01313     tmp1 = double(img1[i])-m11;
<a name="l01314"></a>01314     tmp2 = double(img2[i])-m22;
<a name="l01315"></a>01315     s12 += tmp1*tmp2;
<a name="l01316"></a>01316     s11 += tmp1*tmp1;
<a name="l01317"></a>01317     s22 += tmp2*tmp2;
<a name="l01318"></a>01318   }
<a name="l01319"></a>01319 
<a name="l01320"></a>01320   <span class="keywordtype">double</span> score = s12/sqrt(s11)/sqrt(s22);
<a name="l01321"></a>01321   <span class="keywordflow">return</span> score;
<a name="l01322"></a>01322 }
<a name="l01323"></a>01323 
<a name="l01324"></a>01324 
<a name="l01325"></a><a class="code" href="volimg__proc__declare_8h.html#a858930a3ec361b1bcd673b50fbbb484f">01325</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="volimg__proc_8h.html#a858930a3ec361b1bcd673b50fbbb484f">twopoints_lineprofile_3dimg</a>(T *** img, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> sz0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> sz1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> sz2, <span class="keywordtype">double</span> x1, <span class="keywordtype">double</span> y1, <span class="keywordtype">double</span> z1, <span class="keywordtype">double</span> x2, <span class="keywordtype">double</span> y2, <span class="keywordtype">double</span> z2, T * &amp;profile, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> &amp; profile_len)
<a name="l01326"></a>01326 {
<a name="l01327"></a>01327     <span class="comment">//first reset the output</span>
<a name="l01328"></a>01328     <span class="keywordflow">if</span> (profile) {<span class="keyword">delete</span> profile; profile=0;} <span class="comment">//delete the space if it is no null</span>
<a name="l01329"></a>01329     profile_len = 0;
<a name="l01330"></a>01330 
<a name="l01331"></a>01331     <span class="comment">//then check if the input coordinates are correct or not</span>
<a name="l01332"></a>01332     <span class="keywordflow">if</span> (!img ||
<a name="l01333"></a>01333         sz0&lt;0 || x1&lt;0 || x1&gt;sz0-1 || x2&lt;0 || x2&gt;sz0-1 ||
<a name="l01334"></a>01334         sz1&lt;0 || y1&lt;0 || y1&gt;sz1-1 || y2&lt;0 || y2&gt;sz1-1 ||
<a name="l01335"></a>01335         sz2&lt;0 || z1&lt;0 || z1&gt;sz2-1 || z2&lt;0 || z2&gt;sz2-1)
<a name="l01336"></a>01336     {
<a name="l01337"></a>01337         <span class="keywordflow">return</span>; <span class="comment">//note in this case the return profile is null</span>
<a name="l01338"></a>01338     }
<a name="l01339"></a>01339 
<a name="l01340"></a>01340     <span class="keywordtype">double</span> dx=x2-x1, dy=y2-y1, dz=z2-z1;
<a name="l01341"></a>01341     <span class="keywordtype">double</span> len = sqrt(dx*dx+dy*dy+dz*dz);
<a name="l01342"></a>01342     profile_len = 1 + <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>(len + 0.5); <span class="comment">//+1 because there is at least one element in the profile, which is the starting point (x1,y1,z1)</span>
<a name="l01343"></a>01343     <span class="keywordflow">try</span>
<a name="l01344"></a>01344     {
<a name="l01345"></a>01345         profile = <span class="keyword">new</span> T [profile_len];
<a name="l01346"></a>01346     }
<a name="l01347"></a>01347     <span class="keywordflow">catch</span> (...)
<a name="l01348"></a>01348     {
<a name="l01349"></a>01349         profile = 0;
<a name="l01350"></a>01350         profile_len = 0;
<a name="l01351"></a>01351         <span class="keywordflow">return</span>;
<a name="l01352"></a>01352     }
<a name="l01353"></a>01353 
<a name="l01354"></a>01354     <span class="comment">//now do resampling</span>
<a name="l01355"></a>01355     <span class="keywordtype">double</span> curpx,curpy,curpz; <span class="comment">//the coordinate of the current point</span>
<a name="l01356"></a>01356     <span class="keywordtype">double</span> sx=dx/profile_len, sy=dy/profile_len, sz=dz/profile_len; <span class="comment">//step size</span>
<a name="l01357"></a>01357     <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> n=0;n&lt;profile_len;n++)
<a name="l01358"></a>01358     {
<a name="l01359"></a>01359         curpx = x1+sx*n; curpy = y1+sy*n; curpz = z1+sz*n;
<a name="l01360"></a>01360 
<a name="l01361"></a>01361         <span class="comment">//now compute the interpolated value</span>
<a name="l01362"></a>01362         <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> cpx0, cpx1, cpy0, cpy1, cpz0, cpz1;
<a name="l01363"></a>01363         {
<a name="l01364"></a>01364             curpx=(curpx&lt;0)?0:curpx; curpx=(curpx&gt;=sz0-1)?sz0-1:curpx;
<a name="l01365"></a>01365             curpy=(curpy&lt;0)?0:curpy; curpy=(curpy&gt;=sz1-1)?sz1-1:curpy;
<a name="l01366"></a>01366             curpz=(curpz&lt;0)?0:curpz; curpz=(curpz&gt;=sz2-1)?sz2-1:curpz;
<a name="l01367"></a>01367 
<a name="l01368"></a>01368             cpx0 = <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>(<a class="code" href="vcdiff_8cpp.html#a65f0d7631e66c9e030328c8de8059738">floor</a>(curpx)); cpx1 = <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>(ceil(curpx));
<a name="l01369"></a>01369             cpy0 = <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>(<a class="code" href="vcdiff_8cpp.html#a65f0d7631e66c9e030328c8de8059738">floor</a>(curpy)); cpy1 = <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>(ceil(curpy));
<a name="l01370"></a>01370             cpz0 = <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>(<a class="code" href="vcdiff_8cpp.html#a65f0d7631e66c9e030328c8de8059738">floor</a>(curpz)); cpz1 = <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a>(ceil(curpz));
<a name="l01371"></a>01371 
<a name="l01372"></a>01372             <span class="keywordflow">if</span> (cpz0==cpz1)
<a name="l01373"></a>01373             {
<a name="l01374"></a>01374                 <span class="keywordflow">if</span> (cpy0==cpy1)
<a name="l01375"></a>01375                 {
<a name="l01376"></a>01376                     <span class="keywordflow">if</span> (cpx0==cpx1)
<a name="l01377"></a>01377                     {
<a name="l01378"></a>01378                         profile[n] = (double)(img[cpz0][cpy0][cpx0]);
<a name="l01379"></a>01379                     }
<a name="l01380"></a>01380                     <span class="keywordflow">else</span>
<a name="l01381"></a>01381                     {
<a name="l01382"></a>01382                         <span class="keywordtype">double</span> w0x0y0z = (cpx1-curpx);
<a name="l01383"></a>01383                         <span class="keywordtype">double</span> w1x0y0z = (curpx-cpx0);
<a name="l01384"></a>01384                         profile[n] = (double)(w0x0y0z * <span class="keywordtype">double</span>(img[cpz0][cpy0][cpx0]) +
<a name="l01385"></a>01385                                               w1x0y0z * double(img[cpz0][cpy0][cpx1]));
<a name="l01386"></a>01386                     }
<a name="l01387"></a>01387                 }
<a name="l01388"></a>01388                 <span class="keywordflow">else</span>
<a name="l01389"></a>01389                 {
<a name="l01390"></a>01390                     <span class="keywordflow">if</span> (cpx0==cpx1)
<a name="l01391"></a>01391                     {
<a name="l01392"></a>01392                         <span class="keywordtype">double</span> w0x0y0z = (cpy1-curpy);
<a name="l01393"></a>01393                         <span class="keywordtype">double</span> w0x1y0z = (curpy-cpy0);
<a name="l01394"></a>01394                         profile[n] = (double)(w0x0y0z * <span class="keywordtype">double</span>(img[cpz0][cpy0][cpx0]) +
<a name="l01395"></a>01395                                               w0x1y0z * double(img[cpz0][cpy1][cpx0]));
<a name="l01396"></a>01396                     }
<a name="l01397"></a>01397                     <span class="keywordflow">else</span>
<a name="l01398"></a>01398                     {
<a name="l01399"></a>01399                         <span class="keywordtype">double</span> w0x0y0z = (cpx1-curpx)*(cpy1-curpy);
<a name="l01400"></a>01400                         <span class="keywordtype">double</span> w0x1y0z = (cpx1-curpx)*(curpy-cpy0);
<a name="l01401"></a>01401                         <span class="keywordtype">double</span> w1x0y0z = (curpx-cpx0)*(cpy1-curpy);
<a name="l01402"></a>01402                         <span class="keywordtype">double</span> w1x1y0z = (curpx-cpx0)*(curpy-cpy0);
<a name="l01403"></a>01403                         profile[n] = (double)(w0x0y0z * <span class="keywordtype">double</span>(img[cpz0][cpy0][cpx0]) +
<a name="l01404"></a>01404                                               w0x1y0z * double(img[cpz0][cpy1][cpx0]) +
<a name="l01405"></a>01405                                               w1x0y0z * double(img[cpz0][cpy0][cpx1]) +
<a name="l01406"></a>01406                                               w1x1y0z * double(img[cpz0][cpy1][cpx1]));
<a name="l01407"></a>01407                     }
<a name="l01408"></a>01408                 }
<a name="l01409"></a>01409             }
<a name="l01410"></a>01410             <span class="keywordflow">else</span>
<a name="l01411"></a>01411             {
<a name="l01412"></a>01412                 <span class="keywordflow">if</span> (cpy0==cpy1)
<a name="l01413"></a>01413                 {
<a name="l01414"></a>01414                     <span class="keywordflow">if</span> (cpx0==cpx1)
<a name="l01415"></a>01415                     {
<a name="l01416"></a>01416                         <span class="keywordtype">double</span> w0x0y0z = (cpz1-curpz);
<a name="l01417"></a>01417                         <span class="keywordtype">double</span> w0x0y1z = (curpz-cpz0);
<a name="l01418"></a>01418 
<a name="l01419"></a>01419                         profile[n] = (double)(w0x0y0z * <span class="keywordtype">double</span>(img[cpz0][cpy0][cpx0]) + w0x0y1z * double(img[cpz1][cpy0][cpx0]));
<a name="l01420"></a>01420                     }
<a name="l01421"></a>01421                     <span class="keywordflow">else</span>
<a name="l01422"></a>01422                     {
<a name="l01423"></a>01423                         <span class="keywordtype">double</span> w0x0y0z = (cpx1-curpx)*(cpz1-curpz); <span class="comment">//remove mid term in (cpx1-curpx)*(cpy1-curpy)*(cpz1-curpz), which should be a bug causing 0 in certain place. 080504</span>
<a name="l01424"></a>01424                         <span class="keywordtype">double</span> w0x0y1z = (cpx1-curpx)*(curpz-cpz0);
<a name="l01425"></a>01425 
<a name="l01426"></a>01426                         <span class="keywordtype">double</span> w1x0y0z = (curpx-cpx0)*(cpz1-curpz);
<a name="l01427"></a>01427                         <span class="keywordtype">double</span> w1x0y1z = (curpx-cpx0)*(curpz-cpz0);
<a name="l01428"></a>01428 
<a name="l01429"></a>01429                         profile[n] = (double)(w0x0y0z * <span class="keywordtype">double</span>(img[cpz0][cpy0][cpx0]) + w0x0y1z * double(img[cpz1][cpy0][cpx0]) +
<a name="l01430"></a>01430                                               w1x0y0z * double(img[cpz0][cpy0][cpx1]) + w1x0y1z * double(img[cpz1][cpy0][cpx1]));
<a name="l01431"></a>01431                     }
<a name="l01432"></a>01432                 }
<a name="l01433"></a>01433                 <span class="keywordflow">else</span>
<a name="l01434"></a>01434                 {
<a name="l01435"></a>01435                     <span class="keywordflow">if</span> (cpx0==cpx1)
<a name="l01436"></a>01436                     {
<a name="l01437"></a>01437                         <span class="keywordtype">double</span> w0x0y0z = (cpy1-curpy)*(cpz1-curpz); <span class="comment">//update 080504, remove the first (cpx1-curpx) term, which should be a bug</span>
<a name="l01438"></a>01438                         <span class="keywordtype">double</span> w0x0y1z = (cpy1-curpy)*(curpz-cpz0);
<a name="l01439"></a>01439 
<a name="l01440"></a>01440                         <span class="keywordtype">double</span> w0x1y0z = (curpy-cpy0)*(cpz1-curpz);
<a name="l01441"></a>01441                         <span class="keywordtype">double</span> w0x1y1z = (curpy-cpy0)*(curpz-cpz0);
<a name="l01442"></a>01442 
<a name="l01443"></a>01443                         profile[n] = (double)(w0x0y0z * <span class="keywordtype">double</span>(img[cpz0][cpy0][cpx0]) + w0x0y1z * double(img[cpz1][cpy0][cpx0]) +
<a name="l01444"></a>01444                                               w0x1y0z * double(img[cpz0][cpy1][cpx0]) + w0x1y1z * double(img[cpz1][cpy1][cpx0]));
<a name="l01445"></a>01445                     }
<a name="l01446"></a>01446                     <span class="keywordflow">else</span>
<a name="l01447"></a>01447                     {
<a name="l01448"></a>01448                         <span class="keywordtype">double</span> w0x0y0z = (cpx1-curpx)*(cpy1-curpy)*(cpz1-curpz);
<a name="l01449"></a>01449                         <span class="keywordtype">double</span> w0x0y1z = (cpx1-curpx)*(cpy1-curpy)*(curpz-cpz0);
<a name="l01450"></a>01450 
<a name="l01451"></a>01451                         <span class="keywordtype">double</span> w0x1y0z = (cpx1-curpx)*(curpy-cpy0)*(cpz1-curpz);
<a name="l01452"></a>01452                         <span class="keywordtype">double</span> w0x1y1z = (cpx1-curpx)*(curpy-cpy0)*(curpz-cpz0);
<a name="l01453"></a>01453 
<a name="l01454"></a>01454                         <span class="keywordtype">double</span> w1x0y0z = (curpx-cpx0)*(cpy1-curpy)*(cpz1-curpz);
<a name="l01455"></a>01455                         <span class="keywordtype">double</span> w1x0y1z = (curpx-cpx0)*(cpy1-curpy)*(curpz-cpz0);
<a name="l01456"></a>01456 
<a name="l01457"></a>01457                         <span class="keywordtype">double</span> w1x1y0z = (curpx-cpx0)*(curpy-cpy0)*(cpz1-curpz);
<a name="l01458"></a>01458                         <span class="keywordtype">double</span> w1x1y1z = (curpx-cpx0)*(curpy-cpy0)*(curpz-cpz0);
<a name="l01459"></a>01459 
<a name="l01460"></a>01460                         profile[n] = (double)(w0x0y0z * <span class="keywordtype">double</span>(img[cpz0][cpy0][cpx0]) + w0x0y1z * double(img[cpz1][cpy0][cpx0]) +
<a name="l01461"></a>01461                                               w0x1y0z * double(img[cpz0][cpy1][cpx0]) + w0x1y1z * double(img[cpz1][cpy1][cpx0]) +
<a name="l01462"></a>01462                                               w1x0y0z * double(img[cpz0][cpy0][cpx1]) + w1x0y1z * double(img[cpz1][cpy0][cpx1]) +
<a name="l01463"></a>01463                                               w1x1y0z * double(img[cpz0][cpy1][cpx1]) + w1x1y1z * double(img[cpz1][cpy1][cpx1]) );
<a name="l01464"></a>01464                     }
<a name="l01465"></a>01465                 }
<a name="l01466"></a>01466             }
<a name="l01467"></a>01467         }
<a name="l01468"></a>01468     }
<a name="l01469"></a>01469 
<a name="l01470"></a>01470     <span class="keywordflow">return</span>;
<a name="l01471"></a>01471 }
<a name="l01472"></a>01472 
<a name="l01473"></a><a class="code" href="volimg__proc__declare_8h.html#acfe33b511afab42c3644dba89d56fbef">01473</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keywordtype">double</span> <a class="code" href="volimg__proc_8h.html#acfe33b511afab42c3644dba89d56fbef">twopoints_lineprofile_3dimg_sum</a>(T *** img, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> sz0, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> sz1, <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> sz2, <span class="keywordtype">double</span> x1, <span class="keywordtype">double</span> y1, <span class="keywordtype">double</span> z1, <span class="keywordtype">double</span> x2, <span class="keywordtype">double</span> y2, <span class="keywordtype">double</span> z2)
<a name="l01474"></a>01474 {
<a name="l01475"></a>01475     T *profile=0;
<a name="l01476"></a>01476     <a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> profile_len=0;
<a name="l01477"></a>01477     <a class="code" href="volimg__proc_8h.html#a858930a3ec361b1bcd673b50fbbb484f">twopoints_lineprofile_3dimg</a>(img, sz0, sz1, sz2, x1, y1, z1, x2, y2, z2, profile, profile_len);
<a name="l01478"></a>01478     <span class="keywordflow">if</span> (profile &amp;&amp; profile_len)
<a name="l01479"></a>01479     {
<a name="l01480"></a>01480         <span class="keywordtype">double</span> s=0.0;
<a name="l01481"></a>01481         <span class="keywordflow">for</span> (<a class="code" href="v3d__basicdatatype_8h.html#a9ac0036cddfd2650005e7cbe58da47e6">V3DLONG</a> n=0;n&lt;profile_len;n++)
<a name="l01482"></a>01482             s += profile[n];
<a name="l01483"></a>01483         <span class="keywordflow">if</span> (profile) {<span class="keyword">delete</span> []profile; profile=0;}
<a name="l01484"></a>01484         <span class="keywordflow">return</span> s;
<a name="l01485"></a>01485     }
<a name="l01486"></a>01486     <span class="keywordflow">else</span>
<a name="l01487"></a>01487         <span class="keywordflow">return</span> 0;
<a name="l01488"></a>01488 }
<a name="l01489"></a>01489 
<a name="l01490"></a>01490 <span class="preprocessor">#endif</span>
<a name="l01491"></a>01491 <span class="preprocessor"></span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="volimg__proc_8h.html">volimg_proc.h</a>      </li>
      <li class="footer">Generated on Tue Feb 22 2011 10:19:45 for V3D by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
